<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE section PUBLIC "-//OASIS//DTD DocBook XML V4.3//EN"
"http://www.oasis-open.org/docbook/xml/4.3/docbookx.dtd">
<section id="config"
         xreflabel="config">
  <title>
  Config
  </title>

  <section>
    <title>
    Definition
    </title>

    <para>
    Creates an RPM used to install and update system-specific configuration on
    the client system.  The RPM is named <filename>system-config</filename>.
    The system-config RPM completes three primary functions. It installs
    automatically-generated YUM plugin and repository definition files. It
    installs user-provided configuration files specified via
    <emphasis>config/files</emphasis> elements. And it runs user-provided
    scripts specified via <emphasis>config/script</emphasis> and
    <emphasis>config/trigger</emphasis> elements.
    </para>

    <para>
    This module is a member of the <emphasis role="strong">rpmbuild</emphasis>
    module group.
    </para>
  </section>

  <section>
    <title>
    Syntax
    </title>

    <programlisting>
&lt;config&gt;
  [&lt;updates [sync=boolean] [gpgcheck=boolean]) /&gt;

  [&lt;files [destdir=PATH] [destname=BASENAME] [mode=MODE]
          [content=("file"|"text")]&gt;
    (PATH|TEXT)
   &lt;/files&gt;]*

  [&lt;script type=("post"|"pre"|"preun"|"postun"|"verifyscript")
          [content=("file"|"text")]&gt;
    (PATH|TEXT)
   &lt;/script&gt;]*

  [&lt;obsoletes&gt;CAPABILITY&lt;/obsoletes&gt;]*
  [&lt;requires&gt;CAPABILITY&lt;/requires&gt;]*

  [&lt;trigger package=CAPABILITY type=("triggerin"|"triggerun"|"triggerpostun")
           [content=("file"|"text")] [interpreter=PATH]&gt;
    (PATH|TEXT)
   &lt;/trigger&gt;]*
&lt;/config&gt;
    </programlisting>
  </section>

  <section>
    <title>
    Elements
    </title>

    <variablelist>

    <varlistentry id="config-updates"
                  xreflabel="config/updates">
      <term>
      updates
      </term>

      <listitem>
      <para>
      Controls inclusion of the <application class="software">YUM</application>
      sync plugin; also controls whether gpgchecking is performed. 
      </para>

      <para>
      Accepts two attributes,
      <emphasis>@sync</emphasis> and
      <emphasis>@gpgcheck</emphasis>.
      </para>

      <para>
      <emphasis>@sync</emphasis>: <varname>BOOLEAN</varname> value indicating
      whether to include the <application
      class="software">SystemStudio</application>-provided <application
      class="software">YUM</application> sync plugin in the config RPM. The
      sync plugin overrides <application class="software">YUM</application>'s
      default behavior 1) to disable all repositories other than the
      distribution repository and 2) to provide a <emphasis>sync</emphasis>
      argument that allows adding <emphasis>and removing</emphasis> installed
      packages on client machines in alignment with with available packages in
      the distribution repository. The default value is
      <constant>TRUE</constant>. 
      </para>

      <para>
      <emphasis>@gpgcheck</emphasis>: <varname>BOOLEAN</varname> value
      indicating whether packages should be checked for valid GPG signatures.
      This value controls whether SystemStudio performs gpgchecking when
      creating the distribution. It also controls whether YUM checks packages
      from the distribution prior to performing client machine updates. The
      default value is <constant>TRUE</constant>.
      </para>

      </listitem>
    </varlistentry>

    <varlistentry id="config-files"
                  xreflabel="config/files">
      <term>
      files
      </term>

      <listitem>
      <para>
      Specifies a file or folder containing files to install to the client
      system. Can occur zero or more times.
      </para>

      <para>
      Accepts four attributes:
      <emphasis>@content</emphasis>,
      <emphasis>@destdir</emphasis>,
      <emphasis>@destname</emphasis>, and
      <emphasis>@mode</emphasis>.
      </para>

      <para>
      <emphasis>@content</emphasis>: Accepts either "file" or "text".  
      When <emphasis>content</emphasis> is
      "file", the element's text value is treated as a
      <varname>PATH</varname> to a file, whereas when it is "text", the
      element's text value is interpreted as the raw text to use for creating
      a file with the name specified using the @destname attribute.
      The default value is "file".
      </para>

      <para>
      <emphasis>@destdir</emphasis>: See the path-like attribute
      <emphasis><xref linkend="destdir" /></emphasis>. Controls the
      location to which this file should be installed on the client
      system. The default value is
      <filename>/usr/share/system-config/files</filename>.
      </para>

      <para>
      <emphasis>@destname</emphasis>: See the path-like attribute
      <emphasis><xref linkend="destname" /></emphasis>. If
      <emphasis>@content</emphasis> is "text", this attribute is required.
      </para>

      <para>
      <emphasis>@mode</emphasis>: See the path-like attribute
      <emphasis><xref linkend="mode" /></emphasis>.
      </para>
    </listitem>
    </varlistentry>

    <varlistentry id="config-script"
                  xreflabel="config/script">
      <term>
      script
      </term>

      <listitem>
      <para>
      Specifies a script to run during RPM installation or removal. Can occur
      zero or more times.
      </para>

      <para>
      Accepts two attributes,
      <emphasis>@content</emphasis> and
      <emphasis>@type</emphasis>.
      </para>

      <para>
      <emphasis>@content</emphasis>: Accepts either "file" or "text".  
      When <emphasis>content</emphasis> is "file", the element's text value
      is treated as a <varname>PATH</varname> to a file, whereas when it is
      "text", the element's text value is interpreted as the raw text of the
      script to execute. The default value is "file".
      </para>

      <para>
      <emphasis>@type</emphasis>: Specifies the type of RPM script; must
      be one of "pre", "post", "preun", "postun" or "verifyscript". This
      attribute is required. For more information on defining scripts in
      RPM spec files, see the Fedora project's <emphasis>"RPM Guide"</emphasis>
      by Eric Foster-Johnson.
      </para>
      </listitem>
    </varlistentry>

    <varlistentry id="config-requires"
                  xreflabel="config/requires">
      <term>
      requires
      </term>

      <listitem>
      <para>
      See Common Element
      <emphasis><xref linkend="requires" /></emphasis>. Can occur zero or more
      times.
      </para>
      </listitem>
    </varlistentry>

    <varlistentry id="config-obsoletes"
                  xreflabel="config/obsoletes">
      <term>
      obsoletes
      </term>

      <listitem>
      <para>
      See Common Element <emphasis><xref linkend="obsoletes" /></emphasis>. 
      Can occur zero or more times.
      </para>
      </listitem>
    </varlistentry>

    <varlistentry id="config-trigger"
                  xreflabel="config/trigger">
      <term>
      trigger
      </term>

      <listitem>
      <para>
      Specifies a script to run during RPM installation and removal. Can occur
      zero or more times.
      </para>

      <para>
      Accepts four attributes:
      <emphasis>@content</emphasis>,
      <emphasis>@interpreter</emphasis>,
      <emphasis>@package</emphasis>, and
      <emphasis>@type</emphasis>.
      </para>

      <para>
      <emphasis>@content</emphasis>: Accepts either "file" or "text".  
      When <emphasis>content</emphasis> is "file", the element's text value
      is treated as a <varname>PATH</varname> to a file, whereas when it is
      "text", the element's text value is interpreted as the raw text of the
      script to execute. The default value is "file".
      </para>

      <para>
      <emphasis>@interpreter</emphasis>: The <varname>PATH</varname> to
      the executable language interpreter to use when running the trigger
      script. The default value is <filename>/bin/sh</filename>.
      </para>

      <para>
      <emphasis>@package</emphasis>: The name of the RPM this script
      triggers on.  This attribute is required. See Also the
      <emphasis>@type</emphasis> attribute.
      </para>

      <para>
      <emphasis>@type</emphasis>: Specifies the type of RPM trigger
      script; must be one of "triggerin", "triggerun", or "triggerpostun".
      This attribute is required. For more information on defining trigger
      scripts in RPM spec files, see the Fedora project's
      <emphasis>"RPM Guide"</emphasis> by Eric Foster-Johnson. See Also the
      <emphasis>@package</emphasis>
      attribute.
      </para>
      </listitem>
    </varlistentry>
    </variablelist>
  </section>

  <section>
    <title>
    Examples
    </title>

    <informalexample>
    <programlisting>
&lt;config&gt;
  &lt;!-- put smb.conf in /etc/samba on the client system --&gt;
  &lt;files destdir="/etc/samba"&gt;
    smb.conf
  &lt;/files&gt;

  &lt;!-- rename and change mode of aliases.txt --&gt;
  &lt;files destdir="/etc" destname="aliases" mode="0600"&gt;
    aliases.txt
  &lt;/files&gt;

  &lt;!-- create /etc/hosts using the supplied text --&gt;
  &lt;files destdir="/etc" destname="hosts" content="text"&gt;
# Do not remove the following line, or various programs
# that require network functionality will fail.
127.0.0.1   localhost.localdomain localhost
::1         localhost.localdomain localhost
  &lt;/files&gt;

  &lt;!-- exclude the yum sync plugin --&gt;
  &lt;updates sync="false" /&gt;

  &lt;!-- disable gpgchecking for the distribution --&gt;
  &lt;updates gpgcheck="false" /&gt;

  &lt;!-- required packages --&gt;
  &lt;requires&gt;samba&lt;/requires&gt;
  &lt;requires&gt;samba-common&lt;/requires&gt;

  &lt;!-- add a RPM %post script --&gt;
  &lt;script type="post" content="text"&gt;
/sbin/chkconfig samba on
  &lt;/script&gt;

  &lt;!-- add a RPM %triggerin script that triggers on samba --&gt;
  &lt;trigger package="samba" type="triggerin"&gt;
    scripts/smb-triggerin.sh
  &lt;/trigger&gt;
&lt;/config&gt;
    </programlisting>
    </informalexample>
  </section>

  <section>
    <title>
    See Also
    </title>

    <para>
    <varname><xref linkend="variable-name" /></varname>,
    <varname><xref linkend="content-basename" /></varname>,
    <varname><xref linkend="content-package" /></varname>,
    <varname><xref linkend="content-path" /></varname>,
    <varname><xref linkend="content-text" /></varname>,
    <xref linkend="path-like-element" />,
    <emphasis role="strong"><xref linkend="repos" /></emphasis>
    </para>
  </section>
</section>
