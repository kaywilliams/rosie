<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE section PUBLIC "-//OASIS//DTD DocBook XML V4.3//EN"
"http://www.oasis-open.org/docbook/xml/4.3/docbookx.dtd">
<section id="repos"
         xreflabel="repos">
  <title>
  repos
  </title>

  <section>
    <title>
    Definition
    </title>

    <para>
    Contains a list of repositories that SystemBuilder uses to download its
    packages.
    </para>

    <section id="repos-including-repositories"
             xreflabel="Including Repositories in a System Distribution">
      <title>
      Including Repositories in a System Distribution
      </title>

      <para>
      In order to operate, <application class="software">SystemBuilder
      </application> requires at least one input repository.
      Repositories are specified by either defining them in XML
      (see <emphasis><xref linkend="repos-repo" /></emphasis>) or by
      pointing to a valid
      <application class="software">YUM</application> repofile (see
      <emphasis><xref linkend="repos-repofile" /></emphasis>). All enabled
      repositories are considered. Valid repository definitions must
      include a minimum of one baseurl or mirrorlist. Furthermore, all
      repositories must have a unique id.
      </para>

      <para>
      Exactly one of the input repositories must contain installer
      images and isolinux files, located within folders called
      <filename>images</filename> and <filename>isolinux</filename>,
      respectively. These files are used to create installation images for the
      system distribution.
      </para>
    </section>

  </section>

  <section>
    <title>
    Syntax
    </title>

    <programlisting>
&lt;repos [enabled=BOOLEAN]&gt;

  &lt;!-- at least one repo or repofile element is required --&gt;
 [&lt;repo id=ID&gt;
    &lt;!-- at least one &lt;baseurl&gt; or &lt;mirrorlist&gt; is required --&gt;
   [&lt;baseurl&gt;PATH&lt;/baseurl&gt;]*
   [&lt;mirrorlist&gt;PATH&lt;/mirrorlist&gt;]
   [&lt;enabled&gt;BOOLEAN&lt;/enabled&gt;]
   [&lt;name&gt;TEXT&lt;/name&gt;]
   [&lt;gpgcheck&gt;BOOLEAN&lt;/gpgcheck&gt;]
   [&lt;gpgkey&gt;PATH&lt;gpgkey&gt;]*
   [&lt;exclude&gt;PACKAGE&lt;/exclude&gt;]*
   [&lt;includepkgs&gt;PACKAGE&lt;/includepkgs&gt;]*
   [&lt;systemid&gt;PATH&lt;/systemid&gt;]
  &lt;/repo&gt;]*

 [&lt;repofile&gt;PATH&lt;/repofile&gt;]*

 [&lt;releasever&gt;TEXT&lt;/releasever&gt;]
 [&lt;exclude&gt;PACKAGE&lt;/exclude&gt;]*
&lt;/repos&gt;
    </programlisting>
  </section>

  <section>
    <title>
    Attributes
    </title>

    <variablelist>
    <varlistentry>
      <term>
      enabled
      </term>

      <listitem>
      <para>
      See Common Attribute <emphasis><xref linkend="enabled" /></emphasis>.
      </para>
      </listitem>
    </varlistentry>
    </variablelist>
  </section>

  <section>
    <title>
    Elements
    </title>

    <variablelist>
    <varlistentry>
      <term>
      exclude
      </term>

      <listitem>
      <para>
      A <varname>PACKAGE</varname> pattern to exclude from all repositories
      used in the system distribution. See Also Common Element
      <emphasis><xref linkend="repo" /></emphasis>,
      <xref linkend="repo-including-excluding-repository-contents" /> and the
      <emphasis><xref linkend="repos-repo" /></emphasis> and
      <emphasis><xref linkend="repos-repofile" /></emphasis> elements.
      </para>

      <para>
      This element can occur zero or more times.
      </para>
      </listitem>
    </varlistentry>

    <varlistentry>
      <term>
      releasever
      </term>

      <listitem>
      <para>
      The value to use to replace the <varname>$releasever</varname> YUM
      variable in all repository baseurls and/or mirrorlists instead of
      the default value, <varname>$VERSION</varname>.
      </para>
      </listitem>
    </varlistentry>

    <varlistentry id="repos-repo"
                  xreflabel="repos/repo">
      <term>
      repo
      </term>

      <listitem>
      <para>
      Include a repository from which to select packages for the system
      distribution. See Common Element
      <emphasis><xref linkend="repo" /></emphasis>. See Also
      <xref linkend="repos-including-repositories" /> and
      <xref linkend="repo-including-excluding-repository-contents" />.
      </para>

      <para>
      This element can occur zero or more times. However, the
      <emphasis role="strong">repo</emphasis> top-level element must have
      at least one <emphasis>repos/repo</emphasis> or
      <emphasis>repos/repofile</emphasis> element.
      </para>
      </listitem>
    </varlistentry>

    <varlistentry id="repos-repofile"
                  xreflabel="repos/repofile">
      <term>
      repofile
      </term>

      <listitem>
      <para>
      The <varname>PATH</varname> to a
      <application class="software">YUM</application> repofile.  See also
      Common Element <emphasis><xref linkend="repo" /></emphasis> and
      <xref linkend="repos-including-repositories" />. See also the
      yum.conf man pages for the appropriate syntax of a YUM repofile.
      </para>

      <para>
      This element can occur zero or more times. However, the
      <emphasis role="strong">repo</emphasis> top-level element must have
      at least one <emphasis>repos/repo</emphasis> or
      <emphasis>repos/repofile</emphasis> element.
      </para>
      </listitem>
    </varlistentry>
    </variablelist>
  </section>

  <section>
    <title>
    Examples
    </title>

    <para>
    In the following examples, line breaks have been added to the
    <emphasis>repos/repo/baseurl</emphasis> and
    <emphasis>repos/repo/mirrorlist</emphasis> to improve readability.
    In a real distribution definition file, however, line breaks within
    <varname>PATH</varname>-like elements are not allowed.
    </para>

    <section>
      <title>
      Example 1 - using <emphasis>repos/repo/includepkgs</emphasis>
      and <emphasis>repos/repo/exclude</emphasis>
      </title>

      <para>
      In the following example, two repositories are defined directly 
      in XML. The first repository contains includes all packages except
      those that match the <varname>PACKAGE</varname> pattern "xorg-x11-drv*"
      while the second repository only includes packages that match the
      same pattern.
      </para>

      <para>
      Additionally, SystemBuilder will include any and all repositories defined
      in the file <filename>centos-extras.repo</filename>.
      </para>

      <informalexample>
      <programlisting>
&lt;repos&gt;

  &lt;repo id="base"&gt;

    &lt;!-- $basearch will be replaced by $ARCH, $releasever by $VERSION --&gt;
    &lt;baseurl&gt;http://mirror.centos.org/centos/$releasever/os/
          $basearch/&lt;/baseurl&gt;

    &lt;!-- include a mirrorlist as backup in case baseurl fails --&gt;
    &lt;mirrorlist&gt;http://mirrorlist.centos.org/?release=$releasever&amp;amp;
          arch=$basearch&amp;amp;repo=os&amp;amp;country=us&lt;/mirrorlist&gt;

    &lt;!-- exclude all xorg-x11-drv packages --&gt;
    &lt;exclude&gt;xorg-x11-drv*&lt;/exclude&gt;
  &lt;/repo&gt;

  &lt;repo id="livna-drivers"&gt;
    &lt;baseurl&gt;http://rpm.livna.org/repo/$releasever/$basearch/&lt;baseurl&gt;

    &lt;!-- include only xorg-x11-drv packages --&gt;
    &lt;includepkgs&gt;xorg-x11-drv*&lt;/includepkgs&gt;
  &lt;/repo&gt;

  &lt;!-- include additional repos defined in centos-extras.repo --&gt;
  &lt;repofile&gt;centos-extras.repo&lt;/repofile&gt;
&lt;/repos&gt;
      </programlisting>
      </informalexample>
    </section>

    <section>
      <title>
      Example 2 - Red Hat Network repositories
      </title>

      <para>
      Repositories that utilize the <filename>rhn</filename> or
      <filename>rhns</filename> protocols to contact the Red Hat Network
      require a systemid to be specified. See the <xref linkend="repo" />
      common element for more information on using Red Hat Network
      repositories.
      </para>

      <informalexample>
      <programlisting>
&lt;repos&gt;
  &lt;repo id="base"&gt;
    &lt;name&gt;Red Hat Enterprise Linux - Base&lt;/name&gt;
    &lt;baseurl&gt;http://example.company.com/install_server/redhat/enterprise/
             $releasever/en/os/i386&lt;/baseurl&gt;
  &lt;/repo&gt;
  &lt;repo id="updates"&gt;
    &lt;name&gt;Red Hat Enterprise Linux - Updates&lt;/name&gt;
    &lt;baseurl&gt;rhn:///rhel-i386-server-5&lt;/baseurl&gt;
    &lt;!-- location of the systemid is relative to the distribution definition file --&gt;
    &lt;systemid&gt;systemid-5Server-$basearch&lt;/systemid&gt;
  &lt;/repo&gt;
&lt;/repos&gt; 
      </programlisting>
      </informalexample>

      <note>
      SystemBuilder requires additional software including rhnlib and 
      rhn-client-tools in order to use RHN repositories. To install a 
      complete version of SystemBuilder including all available software, follow 
      the instructions located at 
      http://www.renditionsoftware.com/systembuilder/download.
      </note>

    </section>

    <section>
      <title>
      Example 3 - using <emphasis>repos/releasever</emphasis>
      </title>

      <para>
      The <emphasis>repos/releasever</emphasis> element allows overriding the 
      value used to replace the <varname>$releasever</varname> YUM variable.

      <informalexample>
      <programlisting>
&lt;system&gt;
  &lt;main&gt;
    ...
    &lt;arch&gt;i386&lt;/arch&gt;
    &lt;version&gt;1.0&lt;/version&gt;
    ...
  &lt;/main&gt;
  ...
  &lt;repos&gt;
    &lt;releasever&gt;5&lt;/releasever&gt;
    &lt;repo id="centos-5"&gt;
	    &lt;baseurl&gt;http://mirror.centos.org/centos/$releasever/os/
	          $basearch/&lt;/baseurl&gt;
    &lt;/repo&gt;
  &lt;/repos&gt;
  ...
&lt;/system&gt;
      </programlisting>
      </informalexample>

      In the example above, the baseurl evaluates to:

      <literallayout>http://mirror.centos.org/centos/5/os/i386 </literallayout>

      If <emphasis>repos/releasever</emphasis> had not been included, the
      baseurl instead would have been:

      <literallayout>http://mirror.centos.org/centos/1.0/os/i386 </literallayout>
      </para>
    </section>
  </section>

  <section>
    <title>
    See Also
    </title>

    <para>
    <varname><xref linkend="variable-arch" /></varname>,
    <varname><xref linkend="content-boolean" /></varname>,
    <varname><xref linkend="content-package" /></varname>,
    <varname><xref linkend="content-path" /></varname>,
    <varname><xref linkend="content-text" /></varname>,
    <emphasis><xref linkend="repo" /></emphasis>,
    <xref linkend="repo-including-excluding-repository-contents" />
    </para>
  </section>
</section>
