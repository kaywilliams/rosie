<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE section PUBLIC "-//OASIS//DTD DocBook XML V4.3//EN"
"http://www.oasis-open.org/docbook/xml/4.3/docbookx.dtd">
<section id="test-update"
        >
  <title>
  Test-update
  </title>

  <section>
    <title>
    Definition
    </title>

    <para>
    The <emphasis>test-update</emphasis> element allows testing system updates.
    As with <emphasis>test-install</emphasis> this testing occurs prior to
    publishing the final repository.
    </para>

    <para>
    For complete information on macros, attributes and elements for the
    test-update top-level element, see the Deployment Elements Common Model at
    <xref linkend="deployment-elements-common-model"/>.
    </para>

    <para>
    <emphasis>Test-update</emphasis> is an optional element.
    </para>

  </section>

  <section>
    <title>
    Examples
    </title>

    <para>
    The following examples show configuring Deploy to perform test
    updates using a local virtual machine. See the <emphasis>Deploy User
    Manual</emphasis> for information on configuring the build machine to
    support virtual machine installations.
    </para>

    <para>
    Similar to the examples shown under <xref linkend="test-install"/>, this
    example makes use of two files: the main definition, and the libvirt
    <filename>test-update.xml</filename> template.
    </para>

    <section>
    <title>test-update element</title>
    <para>
    This test-update element accomplishes the following:

    <itemizedlist>
    <listitem><para>
    Sets a macro indicating that the test-update machine should be powered off
    once test-update completes successfully.  Powering down the test-update
    machine may be useful once the system is in maintenance mode, as it
    preserves system resources.
    </para>
    </listitem>

    <listitem>
    <para>
    Uses XInclude to include the libvirt <filename>test-update.xml</filename>
    deployment template.
    </para>
    </listitem>
    </itemizedlist>
    </para>

    <programlisting>
&lt;test-update>
  &lt;macro id='test-update-poweroff'>true&lt;/macro>
  &lt;xi:include href="%{templates-dir}/%{norm-os}/libvirt/test-update.xml" xpointer="xpointer(./*)"/>
&lt;/test-update></programlisting>
    </section>

    <section>
    <title>test-update.xml template</title>
    <para>
    The libvirt <filename>test-update.xml</filename> template, shown below,
    provides the configuration necessary to create and maintain a local virtual
    machine for testing system updates. The template in turn makes use of the
    <filename>deploy-base.xml</filename> template, which is used across
    test-install, test-update and publish modules. In addition, it provides a
    script for conditionally powering off the test-update system after test
    completion. See <xref linkend='templates'/> for information on locating and
    using templates.
    </para>

    <programlisting><xi:include href='../../../../../share/deploy/templates/el6/libvirt/test-update.xml' parse="text" xmlns:xi="http://www.w3.org/2001/XInclude"/></programlisting>
    </section>
  </section>

</section>
