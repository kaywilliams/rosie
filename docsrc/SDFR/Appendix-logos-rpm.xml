<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE appendix PUBLIC "-//OASIS//DTD DocBook XML V4.3//EN"
          "http://www.oasis-open.org/docbook/xml/4.3/docbookx.dtd">
<appendix id="appendix-logos-rpm"
          xreflabel="logos-rpm XML Configuration File">
  <title>
  logos-rpm XML Configuration File
  </title>

  <section>
    <title>
    Definition
    </title>

    <para>
    The <emphasis role="strong"><xref linkend="logos-rpm" /></emphasis>
    module uses an XML-based configuration file to configure the
    contents of the custom logos RPM. This appendix contains the syntax
    of the file's elements and attributes, definitions, and examples of
    use.
    </para>

    <para>
    The <emphasis role="strong">logos-rpm</emphasis> XML configuration file
    allows three primary tasks:

    <orderedlist>
    <listitem>
    <para>
    Copy an existing file to a specified destination location
    </para>
    </listitem>

    <listitem>
    <para>
    Remove an existing file from a specified destination location
    </para>
    </listitem>

    <listitem>
    <para>
    Create a new image in or copy an existing image to a specified
    destination location and optionally write arbitrary text to it
    </para>
    </listitem>

    </orderedlist>
    </para>

    <para>Example implementations of the full
    <emphasis role="strong">logos-rpm</emphasis> XML configuration syntax
    can be found in <filename>/usr/share/systembuilder/logos-rpm/systembuilder-logos</filename>.
    For more information about incorporating branding images into a SystemBuilder
    appliance, see the
    <emphasis role="strong"><xref linkend="logos-rpm" /></emphasis> top-level
    element.
    </para>

    <section>
      <title>
      Processing <emphasis>image</emphasis> and <emphasis>file</emphasis>
      elements
      </title>

      <para>
      SystemBuilder processes <emphasis>image</emphasis> and <emphasis>file</emphasis>
      elements based on the value of their <emphasis>@dest</emphasis> and
      <emphasis>@anaconda-version</emphasis> attributes. All
      <emphasis>image</emphasis> or <emphasis>file</emphasis> elements with
      the same <emphasis>@dest</emphasis> value are sorted based on their
      <emphasis>@anaconda-version</emphasis>; the element with the highest
      anaconda version that is not newer than the anaconda version in the
      appliance being built is used and all others are ignored. If two or
      more elements have the same destination and anaconda version, the
      latest one in the file is used.
      </para>

      <para>
      Advanced tasks can be performed with <emphasis>image</emphasis> and
      <emphasis>file</emphasis> elements, such as removing a specific file
      in a given range of anaconda versions or overriding the default
      behavior by providing an updated value in a file of higher precedence
      (see <emphasis><xref linkend="appendix-precedence"/></emphasis>).
      </para>
    </section>
  </section>

  <section>
    <title>
    Syntax
    </title>

    <section>
      <title>
      Basic Syntax
      </title>

      <programlisting>
&lt;logos-rpm&gt;
  [&lt;precedence&gt;TEXT&lt;/precendence&gt;]

  [&lt;defaults&gt;
    [&lt;width&gt;INTEGER&lt;/width&gt;]
    [&lt;height&gt;INTEGER&lt;/width&gt;]
    [&lt;font&gt;PATH&lt;/font&gt;]
    [&lt;background&gt;HEXCOLOR&lt;/background&gt;]
    [&lt;format&gt;("jpeg"|"png")&lt;/format&gt;]
   &lt;/defaults&gt;]*

  [&lt;file dest=PATH
        [anaconda-version=TEXT]
        [xwindow-type=("kde"|"gnome"|"required")]&gt;
    (&lt;path&gt;PATH&lt;/path&gt; | &lt;remove/&gt;)
   &lt;/file&gt;]*

  [&lt;image dest=PATH
        [anaconda-version=TEXT]
        [xwindow-type=("kde"|"gnome"|"required")]&gt;

   ( &lt;remove/&gt; |

   ( &lt;create&gt;
       [&lt;background&gt;TEXT&lt;/background&gt;]
       [&lt;width&gt;INTEGER&lt;/width&gt;]
       [&lt;height&gt;INTEGER&lt;/height&gt;]
       [&lt;format&gt;TEXT&lt;/format&gt;]
     &lt;/create&gt; |

     &lt;source&gt;PATH&lt;/source&gt; )

    [&lt;string&gt;
       &lt;text&gt;TEXT&lt;/text&gt;

      [&lt;font&gt;PATH&lt;/font&gt;]
      [&lt;font-color&gt;HEXCOLOR&lt;/font-color&gt;]
      [&lt;font-min-size&gt;INTEGER&lt;/font-min-size&gt;]
      [&lt;font-size&gt;INTEGER&lt;/font-size&gt;]

      [&lt;text-alignment&gt;("center"|"left"|"right")&lt;/text-alignment&gt;]
      [&lt;text-max-width&gt;INTEGER&lt;/text-max-width&gt;]
      [&lt;x-position&gt;INTEGER&lt;/x-position&gt;
       &lt;y-position&gt;INTEGER&lt;/y-position&gt;]
     &lt;/string&gt;]* )
   &lt;/image&gt;]*
&lt;/logos-rpm&gt;
      </programlisting>
    </section>
  </section>

  <section>
    <title>
    Content Types
    </title>

    <section>
      <title>
      Content: <varname>HEXCOLOR</varname>
      </title>

      <para>
      A hexadecimal color code preceded by a hash (#) character.
      </para>
    </section>

    <section>
      <title>
      Content: <varname>INTEGER</varname>
      </title>

      <para>
      A <varname>TEXT</varname> value that represents any positive
      integer or zero.
      </para>
    </section>
  </section>

  <section id="appendix-common-attributes-elements"
           xreflabel="Common Attributes and Elements">
    <title>
    Common Attributes and Elements
    </title>

    <section id="appendix-anaconda-version"
             xreflabel="anaconda-version">
      <title>
      Attribute: anaconda-version
      </title>

      <para>
      A valid Anaconda version, with or without the release indicator.
      </para>
    </section>

    <section id="appendix-dest"
             xreflabel="dest">
      <title>
      Attribute: dest
      </title>

      <para>
      Absolute <varname>PATH</varname> to which the source file or
      created file is installed at on the client system.
      </para>

      <para>This is a required attribute of both <emphasis>file</emphasis>
      and <emphasis>image</emphasis> elements.
      </para>
    </section>

    <section id="appendix-xwindow-type"
             xreflabel="xwindow-type">
      <title>
      Attribute: xwindow-type
      </title>

      <para>
      The display manager for which the file or image is a substitute.
      Accepts either of the display manager types "kde" or "gnome" or the
      string "required" indicating it should always be included.
      </para>

      <para>
      The default value of this attribute is "required".
      </para>
    </section>

    <section id="appendix-remove"
             xreflabel="remove">
      <title>
      Element: remove
      </title>

      <para>
      Including this empty tag directs SystemBuilder to not install any file at
      the attribute "dest" <varname>PATH</varname> for the specified
      "anaconda-version." The default alternative behavior is to
      install a file to the "dest" location.
      </para>
    </section>
  </section>

  <section>
    <title>
    Elements
    </title>

    <section id="appendix-precedence"
             xreflabel="precedence">
      <title>
      precedence
      </title>

      <para>
      Sets the <varname>INTEGER</varname> precedence of this configuration
      file. When multiple XML files are processed, those files with a higher
      precedence are used over those with lowere precedence.
      </para>

      <para>
      The default text value of this element is "1".
      </para>
    </section>

    <section id="appendix-defaults"
             xreflabel="defaults">
      <title>
      defaults
      </title>

      <para>
      Defines the default values for the following elements:
      <emphasis>image/create/background</emphasis>,
      <emphasis>image/create/format</emphasis>,
      <emphasis>image/create/height</emphasis>,
      <emphasis>image/create/width</emphasis>, and
      <emphasis>image/string/font</emphasis>.
      </para>

      <variablelist>
      <varlistentry>
        <term>
        background
        </term>

        <listitem>
        <para>
        The <varname>HEXCOLOR</varname> to use as the default for
        <emphasis>image/create/background</emphasis>. If not specified,
        picks a value based on the source distribution name and version.
        </para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>
        font
        </term>

        <listitem>
        <para>
        The <varname>PATH</varname> to a TrueType font to use as the default
        for <emphasis>image/string/font</emphasis>.
        </para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>
        format
        </term>

        <listitem>
        <para>
        Case-insensitive <varname>TEXT</varname> indicating the image
        format to use as a default for 
        <emphasis>create/image/format</emphasis>. Must be one
        of "jpg" or "png". This element's default text value is "png".
        </para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>
        height
        </term>

        <listitem>
        <para>
        The <varname>INTEGER</varname> height to use as the default for
        <emphasis>image/create/height</emphasis>. This element's default
        text value is "480".
        </para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>
        width
        </term>

        <listitem>
        <para>
        The <varname>INTEGER</varname> width to use as the default for
        <emphasis>image/create/width</emphasis>. This element's default
        text value is "640".
        </para>
        </listitem>
      </varlistentry>
      </variablelist>
    </section>

    <section>
      <title>
      file
      </title>

      <para>
      Manages installation and removal of files on the client system.
      This element must contain either a <emphasis>file/path</emphasis> or
      <emphasis>file/remove</emphasis> element. It accepts three attribuetes,
      <emphasis>@anaconda-version</emphasis>, <emphasis>@dest</emphasis>
      and <emphasis>@xwindow-type</emphasis>, all of which are detailed in
      <xref linkend="appendix-common-attributes-elements" />.
      </para>

      <variablelist>
      <varlistentry>
        <term>
        path
        </term>

        <listitem>
        <para>
        The <varname>PATH</varname> to the source file that is to be
        installed at <emphasis>file/@dest</emphasis>.
        </para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>
        remove
        </term>

        <listitem>
        Removes the given <emphasis>file/@dest</emphasis> from the
        client system instead of copying an existing file to that
        location.
        </listitem>
      </varlistentry>
      </variablelist>
    </section>

    <section>
      <title>
      image
      </title>

      <para>
      Manages installation and removal of images the client system.
      This element must contain either a <emphasis>image/create</emphasis>,
      <emphasis>image/source</emphasis>, or <emphasis>file/remove</emphasis>
      element. It accepts three attribuetes,
      <emphasis>@anaconda-version</emphasis>, <emphasis>@dest</emphasis>
      and <emphasis>@xwindow-type</emphasis>, all of which are detailed in
      <xref linkend="appendix-common-attributes-elements" />.
      </para>

      <para>
      When using <emphasis>image/create</emphasis> or
      <emphasis>image/source</emphasis>,
      <emphasis>image/string</emphasis> elements may also be used in order
      to place strings on the resuliting image.
      </para>

      <variablelist>
      <varlistentry>
        <term>
        create
        </term>

        <listitem>
        <para>
        Create a static image that is to be installed at
        <emphasis>image/@dest</emphasis>.
        </para>

        <variablelist>
        <varlistentry>
          <term>
          background
          </term>

          <listitem>
          <para>
          The <varname>HEXCOLOR</varname> to use as background color.
          If not specified, uses the default value defined in
          <emphasis>defaults/background</emphasis>.
          </para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term>
          format
          </term>

          <listitem>
          <para>
          The format of the image to create. If not specified, uses the
          default value defined in <emphasis>defaults/format</emphasis>.
          </para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term>
          height
          </term>

          <listitem>
          <para>
          The <varname>INTEGER</varname> height of the image to create.
          If not specified, uses the default value defined in
          <emphasis>defaults/height</emphasis>.
          </para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term>
          width
          </term>

          <listitem>
          <para>
          The <varname>INTEGER</varname> width of the image to create.
          If not specified, uses the default value defined in
          <emphasis>defaults/width</emphasis>.
          </para>
          </listitem>
        </varlistentry>
        </variablelist>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>
        remove
        </term>

        <listitem>
        <para>
        Removes the given <emphasis>image/@dest</emphasis> from the
        client system instead of copying an existing file to that
        location.
        </para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>
        source
        </term>

        <listitem>
        <para>
        The <varname>PATH</varname> to the source image that is to be
        installed at <emphasis>image/@dest</emphasis>.
        </para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>
        string
        </term>

        <listitem>
        <para>
        Allows arbitrary text to be written to the image. Each
        <emphasis>image/string</emphasis> element defines one line
        of text.
        </para>

        <para>
        This element can occur zero or more times when either the
        <emphasis>image/create</emphasis> or
        <emphasis>image/source</emphasis> elements is used.
        </para>

        <variablelist>
        <varlistentry>
          <term>
          font
          </term>

          <listitem>
          <para>
          The <varname>PATH</varname> to a TrueType font to use when writing
          this string. If not specified, uses the default value defined in
          <emphasis>defaults/font</emphasis>; if this value is not defined,
          SystemBuilder raises an exception.
          </para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term>
          font-color
          </term>

          <listitem>
          <para>
          The <varname>HEXCOLOR</varname> of the text written to the image
          The default value is white (<constant>#ffffff</constant>).
          </para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term>
          font-min-size
          </term>

          <listitem>
          <para>
          The minimum <varname>INTEGER</varname> point size SystemBuilder is allowed
          to use when automatically resizing text to make it fit the image.
          </para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term>
          text
          </term>

          <listitem>
          <para>
          The <varname>TEXT</varname> to write to the image. The text value
          of the appliance file's <emphasis>main/*</emphasis> elements may
          be included using <constant>%{$element}</constant>, where
          <varname>$element</varname> is the name of the child element from
          which to retrieve the text value.
          </para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term>
          text-alignment
          </term>

          <listitem>
          <para>
          The justification of the text on the image. Accepts "left",
          "right", and "center". If not specified, the default value
          is "center".
          </para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term>
          text-max-width
          </term>

          <listitem>
          <para>
          An <varname>INTEGER</varname> value specifying the maximum width
          of the text in pixels. The default value is the width of the
          image.
          </para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term>
          x-position
          </term>

          <listitem>
          <para>
          The <varname>INTEGER</varname> x-coordinate from which to start
          drawing the text. If this element is used,
          <emphasis>image/string/y-position</emphasis> is also required.
          If not specified, the default value is half the image's width.
          </para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term>
          y-position
          </term>

          <listitem>
          <para>
          The <varname>INTEGER</varname> y-coordinate from which to start
          drawing the text. If this element is used,
          <emphasis>image/string/x-position</emphasis> is also required.
          If not specified, the default value is half the image's height.
          </para>
          </listitem>
        </varlistentry>
        </variablelist>
        </listitem>
      </varlistentry>
      </variablelist>
    </section>
  </section>

  <section>
    <title>
    Examples
    </title>

    <para>
    In the following examples, a number of image defaults have been set
    up using the <emphasis>defaults</emphasis> element:
    </para>

    <informalexample>
    <programlisting>
&lt;defaults&gt;
  &lt;background&gt;#000000&lt;/background&gt;
  &lt;height&gt;600&lt;/width&gt;
  &lt;width&gt;800&lt;/width&gt;
  &lt;font&gt;fonts/DejaVuLGCSans.ttf&lt;/font&gt;
&lt;/defaults&gt;
    </programlisting>
    </informalexample>

    <section>
      <title>
      Example 1 - Using <emphasis>file</emphasis> elements
      </title>

      <para>
      In this example, the <emphasis>file</emphasis> elements are used to
      illustrate various methods for handling customized display manager
      files and configuration. The first unconditionally copies the
      <filename>files/backgrounds/systembuilder.xml</filename> to the specified
      destination.  The second and third copy display manager-specific
      files only when the logos RPM is including xwindow art of the given
      type (see
      <emphasis role="strong"><xref linkend="logos-rpm" /></emphasis>'s
      <emphasis>include-xwindows-art</emphasis> element). The fourth removes
      the specified destionation file for appliances using anaconda versions
      11.3.0.36-1 or later.
      </para>

      <informalexample>
      <programlisting>
&lt;file dest="/usr/share/backgrounds/systembuilder/systembuilder.xml"&gt;
  &lt;path&gt;files/backgrounds/systembuilder.xml&lt;/path&gt;
&lt;/file&gt;

&lt;file dest="/usr/share/gnome-screensaver/lock-dialog-system.glade"
      xwindow-type="gnome"&gt;
  &lt;path&gt;files/gnome-screensaver/lock-dialog-system.glade&lt;/path&gt;
&lt;/file&gt;

&lt;file dest="/usr/share/apps/kdm/themes/SystemBuilder/GdmGreeterTheme.desktop"
      xwindow-type="kde"&gt;
  &lt;path&gt;files/kdm/GdmGreeterTheme.desktop&lt;/path&gt;
&lt;/file&gt;

&lt;file dest="/usr/share/apps/kdm/themes/SystemBuilder/GdmGreeterTheme.desktop"
      anaconda-version="11.3.0.36-1"&gt;
  &lt;remove/&gt;
&lt;/file&gt;
      </programlisting>
      </informalexample>
    </section>

    <section>
      <title>
      Example 2 - Using <emphasis>image</emphasis> elements
      </title>

      <para>
      The <emphasis>image</emphasis> element allows creating basic images or 
      including existing images with or without text. The processing of the 
      <emphasis>image/@xwindow-type</emphasis> and 
      <emphasis>image/@anaconda-version</emphasis> attributes are the
      same as for <emphasis>file/@xwindow-type</emphasis> and
      <emphasis>file/@anaconda-version</emphasis>, respectively.
      </para>

      <para>
      Creating images using the <emphasis>image/create</emphasis> and
      <emphasis>image/string</emphasis> elements allows the system
      administrator to create images with a plain background and arbitrary
      text on the fly. In this example, an 350x224 pixel image is created
      in "png" format with a gray background. The image contains the text
      from the <emphasis>main/fullname</emphasis>,
      <emphasis>main/version</emphasis>, and
      <emphasis>main/copyright</emphasis> elements from the appliance file.
      </para>

      <informalexample>
      <programlisting>
&lt;image dest="/usr/share/anaconda/pixmaps/progress_first-lowres.png"
       xwindow-type="required"&gt;
  &lt;create&gt;
    &lt;width&gt;350&lt;/width&gt;
    &lt;height&gt;224&lt;/height&gt;
    &lt;background&gt;#808080&lt;/background&gt;
  &lt;/create&gt;
  &lt;string&gt;
    &lt;x-position&gt;100&lt;/x-position&gt;
    &lt;y-position&gt;180&lt;/y-position&gt;
    &lt;font&gt;fonts/DejaVuLGCSans-Bold.ttf&lt;/font&gt;
    &lt;font-size&gt;18&lt;/font-size&gt;
    &lt;text-max-width&gt;180&lt;/text-max-width&gt;
    &lt;font-min-size&gt;9&lt;/font-min-size&gt;
    &lt;text&gt;%{fullname}&lt;/text&gt;
    &lt;font-color&gt;#ffffff&lt;/font-color&gt;
  &lt;/string&gt;
  &lt;string&gt;
    &lt;x-position&gt;210&lt;/x-position&gt;
    &lt;y-position&gt;110&lt;/y-position&gt;
    &lt;font-color&gt;#ffffff&lt;/font-color&gt;
    &lt;font-size&gt;9&lt;/font-size&gt;
    &lt;text&gt;Version %{version}&lt;/text&gt;
  &lt;/string&gt;
  &lt;string&gt;
    &lt;x-position&gt;175&lt;/x-position&gt;
    &lt;y-position&gt;215&lt;/y-position&gt;
    &lt;font-color&gt;#9d9d9d&lt;/font-color&gt;
    &lt;font-size&gt;9&lt;/font-size&gt;
    &lt;text&gt;%{copyright}&lt;/text&gt;
  &lt;/string&gt;
&lt;/image&gt;
      </programlisting>
      </informalexample>
    </section>

    <section>
      <title>
      Example 3 - precedence
      </title>

      <para>
      Later elements take precedence over earlier ones with the same
      "dest" and "anaconda-version" attribute values. In the
      following examples, SystemBuilder installs nothing at
      <filename>/usr/share/customtext/opening.html</filename> for anaconda
      versions 11.3.0.19-1 or greater but does install
      <filename>files/kdm/SystemBuilderKDM.xml</filename> to
      <filename>/usr/share/kde4/apps/kdm/themes/SystemBuilder/SystemBuilderKDM.xml</filename>
      for anaconda versions 11.3.0.36-1 and later.
      </para>

      <informalexample>
      <programlisting>
&lt;file dest="/usr/share/customtext/opening.html"
      anaconda-version="11.3.0.19-1"
      xwindow-type="kde"&gt;
  &lt;path&gt;files/kdm/SystemBuilderKDM.xml&lt;/path&gt;
&lt;/file&gt;
&lt;file dest="/usr/share/customtext/opening.html"
      anaconda-version="11.3.0.19-1"&gt;
  &lt;remove/&gt;
&lt;/file&gt;
&lt;file dest="/usr/share/kde4/apps/kdm/themes/SystemBuilder/SystemBuilderKDM.xml"
      anaconda-version="11.3.0.36-1"
      xwindow-type="kde"&gt;
  &lt;path&gt;files/kdm/SystemBuilderKDM.xml&lt;/path&gt;
&lt;/file&gt;
      </programlisting>
      </informalexample>

      <para>
      Files with higher precedence are read after files with lower precedence,
      so all elements within naturally take precedence over those defined
      in files that were read earlier.
      </para>
    </section>
  </section>

  <section>
    <title>
    See Also
    </title>

    <para>
    <varname><xref linkend="content-path" /></varname>,
    <varname><xref linkend="content-text" /></varname>,
    <emphasis role="strong"><xref linkend="main" /></emphasis>,
    <emphasis role="strong"><xref linkend="logos-rpm" /></emphasis>
    </para>
  </section>
</appendix>
