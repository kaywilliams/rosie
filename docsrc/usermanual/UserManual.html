<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>SystemBuilder User Manual</title><meta name="generator" content="DocBook XSL Stylesheets V1.69.1" /></head><body><div class="book" lang="en" xml:lang="en"><div class="titlepage"><div><div><h1 class="title"><a id="id2729522"></a>SystemBuilder User Manual</h1></div><div><div class="author"><h3 class="author"></h3><div class="affiliation"><span class="orgname">Rendition Software<br /></span></div></div></div><div><p class="copyright">Copyright © 2010  Rendition Software. </p></div><div><div class="legalnotice"><a id="id2755924"></a><p>All Rights Reserved.</p></div></div><div><p class="pubdate">March 2010</p></div></div><hr /></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="chapter"><a href="#id2770575">1. Preface</a></span></dt><dd><dl><dt><span class="section"><a href="#id2753196">1.1. Audience</a></span></dt><dt><span class="section"><a href="#id2772729">1.2. What's Not Covered</a></span></dt><dt><span class="section"><a href="#id2729973">1.3. How to Read</a></span></dt><dt><span class="section"><a href="#id2729989">1.4. Conventions Used</a></span></dt><dt><span class="section"><a href="#id2730232">1.5. Organization</a></span></dt><dt><span class="section"><a href="#id2728676">1.6. Getting SystemBuilder</a></span></dt></dl></dd><dt><span class="chapter"><a href="#id2728696">2. Introduction</a></span></dt><dd><dl><dt><span class="section"><a href="#id2728702">2.1. <span class="application">SystemBuilder</span> Overview
  </a></span></dt><dt><span class="section"><a href="#id2730408">2.2. Building Distributions</a></span></dt><dt><span class="section"><a href="#installing-client-machines">2.3. Installing Client Machines</a></span></dt><dt><span class="section"><a href="#updating-client-machines">2.4. Updating Client Machines</a></span></dt><dt><span class="section"><a href="#id2743557">2.5. SystemBuilder Files and Folders</a></span></dt><dt><span class="section"><a href="#id2782785">2.6. Glossary of Terms</a></span></dt></dl></dd><dt><span class="chapter"><a href="#id2783344">3. Building a Distribution</a></span></dt><dd><dl><dt><span class="section"><a href="#configuring-a-build-machine">3.1. Configuring a Build Machine</a></span></dt><dt><span class="section"><a href="#id2783574">3.2. Choosing a Use Case: A Samba Server</a></span></dt><dt><span class="section"><a href="#defining-a-distribution">3.3. Defining a Distribution</a></span></dt><dt><span class="section"><a href="#id2784768">3.4. Building a Distribution</a></span></dt><dt><span class="section"><a href="#installing-physical-and-virtual-clients">3.5. Installing Physical and Virtual Clients</a></span></dt><dt><span class="section"><a href="#id2785395">3.6. Updating a Distribution</a></span></dt><dt><span class="section"><a href="#updating-a-client-machine">3.7. Updating a Client Machine</a></span></dt><dt><span class="section"><a href="#id2785844">3.8. Tying it All Together</a></span></dt></dl></dd><dt><span class="chapter"><a href="#id2786093">4. Production Distributions</a></span></dt><dd><dl><dt><span class="section"><a href="#id2786141">4.1. Overview</a></span></dt><dt><span class="section"><a href="#production-definitions">4.2. Production Definitions</a></span></dt><dt><span class="section"><a href="#versioning-definitions">4.3. Versioning Definitions</a></span></dt><dt><span class="section"><a href="#creating-a-staging-machine">4.4. Creating a Staging Machine</a></span></dt><dt><span class="section"><a href="#deploying-production-clients">4.5. Deploying Production Clients</a></span></dt><dt><span class="section"><a href="#testing-production-updates">4.6. Testing Production Updates</a></span></dt><dt><span class="section"><a href="#id2787294">4.7. Versioning Distributions</a></span></dt><dt><span class="section"><a href="#id2787301">4.8. Creating a Download Server</a></span></dt></dl></dd><dt><span class="chapter"><a href="#id2787308">5. Doing More with SystemBuilder</a></span></dt><dd><dl><dt><span class="section"><a href="#id2787343">5.1. Enhancing Your Samba Server</a></span></dt><dt><span class="section"><a href="#automating-installations">5.2. Automating Installations</a></span></dt><dt><span class="section"><a href="#using-scripts-and-triggers">5.3. Using Scripts and Triggers</a></span></dt><dt><span class="section"><a href="#id2787757">5.4. Verifying Package Integrity</a></span></dt><dt><span class="section"><a href="#id2787887">5.5. Creating CD/DVD Images</a></span></dt><dt><span class="section"><a href="#id2787972">5.6. Renaming a Distribution</a></span></dt></dl></dd><dt><span class="chapter"><a href="#id2787984">6. Appendix A</a></span></dt><dd><dl><dt><span class="section"><a href="#id2787990">6.1. Example SystemBuilder Output</a></span></dt></dl></dd></dl></div><div class="chapter" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title"><a id="id2770575"></a>Chapter 1. Preface</h2></div></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id2753196"></a>1.1. Audience</h2></div></div></div><p>SystemBuilder is a product intended for system administrators
    who need to build, test, deploy and maintain Red Hat Enterprise Linux or 
    CentOS-based systems. Certain chapters in this manual assume you have a 
    particular level of knowledge.</p><p>For Chapter 3, "Building a Distribution," in addition to knowing how
    to create and edit XML files, manage a web server and create USB and CD/DVD
    boot media, you should have an intermediate skill level with the following
    components:</p><div class="itemizedlist"><ul type="disc"><li><p>Red Hat Enterprise Linux or CentOS installation, usage, 
          system administration and configuration;</p></li><li><p><span class="application">RPM</span> package usage;
          and</p></li><li><p><span class="application">YUM</span> usage and
          configuration.</p></li></ul></div><p>For Chapter 4, "Creating a Production Environment," experience
    with version control systems, local mirror hosting, XPath and XInclude.
    </p><p>For Chapter 5, "Doing More with SystemBuilder," key skills
    include understanding how to automate Anaconda installations using 
    kickstart files and command line arguments.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id2772729"></a>1.2. What's Not Covered</h2></div></div></div><p>This manual complements several <span class="application">SystemBuilder</span> documents. The "Installation
    Instructions" and "Getting Started Guide" provide basic information about
    obtaining and installing SystemBuilder and creating a basic CentOS system
    distribution. The "Distribution Definition File Reference" (DDFR) contains
    the syntax for distribution definition elements and attributes. 
    Finally, SystemBuilder has a set of 
    <span class="strong"><strong>man pages</strong></span> explaining the
    <span><strong class="command">systembuilder</strong></span> command, its options and the SystemBuilder
    configuration file, <code class="filename">systembuilder.conf</code>. This manual 
    contains references to all four throughout the text.</p><p>These SystemBuilder documents are available at the Rendition
    Software SystemBuilder documentation website.
    </p><p>
    <a href="http://www.renditionsoftware.com/systembuilder/docs/" target="_top">
    http://www.renditionsoftware.com/systembuilder/docs/ </a>
    </p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id2729973"></a>1.3. How to Read</h2></div></div></div><p>The intent of the manual is to help you use SystemBuilder effectively
    to build and maintain distributions, and to use distributions to
    install and update client machines. This manual takes a top-down approach,
    explaining the concepts before giving steps, commands and code examples
    that you can use to build, deploy and enhance your own distributions.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id2729989"></a>1.4. Conventions Used</h2></div></div></div><p>The document conventions are alphabetically listed below.</p><div class="variablelist"><dl><dt><span class="term"><span class="strong"><strong>Caution</strong></span></span></dt><dd><p>The Caution tag flags issues of importance.</p><div class="caution" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Caution"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Caution]" src="images/caution.png" /></td><th align="left">Caution</th></tr><tr><td align="left" valign="top"><p>Using the 'dd' command to copy the diskboot.img file onto
              a USB key will destroy existing data on the device.</p></td></tr></table></div></dd><dt><span class="term"><span class="strong"><strong>Commands</strong></span></span></dt><dd><p><span><strong class="command">Command</strong></span> names in SystemBuilder or
          <code class="function">function</code> names in other programs appear
          throughout the document.</p></dd><dt><span class="term"><span class="strong"><strong>Elements and
        Attributes</strong></span></span></dt><dd><p>Elements and attributes in XML are referred to by their XPath
          equivalents. The active node is always considered to be the root,
          distribution; thus, the first element in the XPath expression is the
          top-level element, while subsequent elements/attributes are its
          children. Top-level elements in the DDFR and their child elements
          use the <span class="emphasis"><em>parent/child/child</em></span> format, while
          <span class="emphasis"><em>@attribute-names</em></span> are preceded by an @ symbol.
          The assumed parent element is <span class="emphasis"><em>distribution</em></span>. For
          more details on XPath syntax, see <a href="http://www.w3.org/TR/xpath.html" target="_top">XML Path Language</a>.
          </p></dd><dt><a id="example"></a><span class="term"><span class="strong"><strong>Examples</strong></span></span></dt><dd><p>Code examples appear in a box, displayed below.</p><div class="informalexample"><pre class="programlisting">&lt;!-- This is a comment in an example code section --&gt;</pre></div></dd><dt><span class="term"><span class="strong"><strong>Filenames</strong></span></span></dt><dd><p><code class="filename">Filenames</code>, <code class="filename">folder names</code>, 
          <code class="filename">directory trees</code> and
          <code class="filename">file extensions</code> all use a
          monospace format.</p></dd><dt><span class="term"><span class="strong"><strong>Important</strong></span></span></dt><dd><p>Critical items appear with an "Important" set off tag: </p><p>
              </p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="images/important.png" /></td><th align="left">Important</th></tr><tr><td align="left" valign="top"><p>The <span class="emphasis"><em>main</em></span> top-level element is
                required.</p></td></tr></table></div><p>
            </p></dd><dt><span class="term"><span class="strong"><strong>Notes</strong></span></span></dt><dd><p>Within distribution definition examples, the traditional XML comment
          tags "&lt;!--" and "--&gt;" contain notes. See Also <a href="#example">example</a> .</p><p>A set-off tag highlights things that a user needs to
          know.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png" /></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>The top-level elements can be in any order in the
              distribution definition.</p></td></tr></table></div></dd><dt><span class="term"><span class="strong"><strong>Screen output</strong></span></span></dt><dd><p>Computer output to the screen can be <code class="computeroutput">inline
          computer output</code>, usually in Courier monospace font,
          or included in a box, as in the case below.</p><pre class="screen">/usr/bin/systembuilder</pre></dd><dt><span class="term"><span class="strong"><strong>User Input</strong></span></span></dt><dd><p>Commands entered by the user appear as <strong class="userinput"><code>inline
          commands</code></strong> or formatted as an <a href="#example">example</a>.
          If the latter, then special characters indicate different users, as
          shown below.</p><div class="informalexample"><pre class="programlisting"># precedes lines entered as a root user

$ precedes lines entered as a normal user</pre></div></dd><dt><span class="term"><span class="strong"><strong>Variables</strong></span></span></dt><dd><p>SystemBuilder variables are presented in monospace font preceded by a
          dollar sign, e.g. <code class="varname">$ID</code>. Variables outside
          the SystemBuilder realm appear in lowercase in monospace font preceded by a
          dollar sign, e.g. <code class="varname">$releasever</code>.</p></dd></dl></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id2730232"></a>1.5. Organization</h2></div></div></div><p>This manual contains five chapters, each with an increasing level of
  complexity and detail.</p><div class="itemizedlist"><ul type="disc"><li><p>Chapter I, "Preface," provides information about how to use and
          read this manual. It also contains information on obtaining the 
          <span class="application">SystemBuilder</span> product.
          </p></li><li><p>Chapter 2, "Introduction" explains what a 
          distribution is, how <span class="application">SystemBuilder
          </span> helps you build it in an efficient timely manner
          and the underlying architecture that makes this improved performance
          possible. The section also includes a "Glossary of Terms" explaining
          terms used within the <span class="application">SystemBuilder</span> realm.</p></li><li><p>Chapter 3, "Building a Distribution," covers the basic
          concepts for configuring the <span class="application">SystemBuilder</span> build machine,
          defining and deploying a distribution, running <span class="application">SystemBuilder</span> and updating a
          distribution. As a use case model, these sections will help you
          create a basic <span class="application">Samba</span>
          server distribution based on CentOS 5.</p></li><li><p>Chapter 4, "Creating a Production Environment," will help you
          set up a managed development and deployment environment using
          SystemBuilder as its cornerstone. It explains implementing the 
          development - staging - production environment within the context of 
          building and deploying distributions using <span class="application">SystemBuilder</span>. The Samba server
          distribution you created in Part I will have new features
          requirements to implement in Part II.</p><p>Chapter 4 also discusses how SystemBuilder makes your life
          easier as a system or build administrator. Versioning distribution
          files and utilizing an object-oriented model through the XInclude
          mechanism for the distribution definitions are important usability
          features. Choosing the best location for storing and downloading
          a distribution via the web is another key concept.</p></li><li><p>Chapter 5, "Doing More with SystemBuilder" will help you
          customize your distributions. It describes using kickstart files to 
          automate client installation, discusses GPG checking and
          using GPG keys to sign your own packages, and provides information on 
          creating CD/DVD installation images.</p></li></ul></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id2728676"></a>1.6. Getting SystemBuilder</h2></div></div></div><p>SystemBuilder and associated documents are available at
    <a href="http://www.renditionsoftware.com/systembuilder/" target="_top"> the Rendition
    Software SystemBuilder website</a> 
    at www.renditionsoftware.com/systembuilder.</p></div></div><div class="chapter" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title"><a id="id2728696"></a>Chapter 2. Introduction</h2></div></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id2728702"></a>2.1. <span class="application">SystemBuilder</span> Overview
  </h2></div></div></div><p>Automating customization, installation and maintenance of Red Hat 
  Enterprise Linux and CentOS systems today requires costly and complex management
  solutions. <span class="application">SystemBuilder</span> provides
  a simple, standard, reliable alternative. SystemBuilder packages 
  user-specified content into standard operating system deployment bundles, or 
  <span class="emphasis"><em>distributions</em></span>. System distributions can be used to
  deploy and maintain client machines, physical and virtual, in a wide range of
  IT environments.</p><p>A distribution is a set of operating system components,
  applications and configuration, packaged for deployment in a standard format.
  Using SystemBuilder you can create and maintain distributions:</p><div class="itemizedlist"><ul type="disc"><li><p>select an operating system,</p></li><li><p>combine it with one or more applications,</p></li><li><p>set operating system and application configuration parameters,</p></li><li><p>build the distribution,</p></li><li><p>deploy it to clients using standard tools and methods,</p></li><li><p>change components and configuration,</p></li><li><p>rebuild the distribution and</p></li><li><p>update existing clients using standard update tools.</p></li></ul></div><div class="mediaobject"><img src="systembuilder_overview.png" /><div class="caption"><p>SystemBuilder Overview</p></div></div><p><span class="application">SystemBuilder</span> reads 
  a distribution definition, gathers various inputs (operating system, applications, 
  and configuration files), and creates a distribution 
  with installation images and a package repository. Using the installation
  images, you can deploy the distribution to one or more client machines. You can 
  also update existing clients from the distribution package repository.
  </p><p>In summary, SystemBuilder is a production system life cycle manager
  for use in defining, building and maintaining distributions that can
  be easily installed and updated on physical, virtual and cloud machines using
  industry standard deployment and update tools.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id2730408"></a>2.2. Building Distributions</h2></div></div></div><p>Running 
  <span class="application">SystemBuilder</span> gathers distribution
  content, processes it, and creates a complete distribution.</p><div class="mediaobject"><img src="build_overview.png" /><div class="caption"><p>SystemBuilder Build Process</p></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id2730442"></a>Build Input</h3></div></div></div><p><span class="application">SystemBuilder</span> uses three classes of input to create distributions: a base operating system, package repositories, and configuration files and scripts. Distribution content is specified using a <a href="#distribution_definition">distribution definition</a>.</p><div class="itemizedlist"><ul type="disc"><li><span class="strong"><strong> Base Operating System.</strong></span> SystemBuilder requires a base operating system distribution as input for creating new distributions. The base operating system is defined at the level of operating system name (Red Hat Enterprise Linux or CentOS), version (5) and architecture (i386 or x86_64). The four base operating systems SystemBuilder supports are RHEL-5-i386, RHEL-5-x86_64, CentOS-5-i386 and CentOS-5-x86_64. Base operating system distributions must include both network installation images and package repositories. Base operating system distribution are covered in more detail under <a href="#specifying-repositories">Specifying Repositories</a>.</li><li><span class="strong"><strong>Package Repositories.</strong></span> SystemBuilder uses RPM package repositories to locate and download software components for the distribution. SystemBuilder requires at least one package repository, that of the base operating system distribution. A typical distribution definition will specify multiple input repositories, including the base operating system update repository, and repositories made available from other internal and external providers. See <a href="#specifying-repositories">Specifying Repositories</a> for more information.</li><li><span class="strong"><strong>Configuration Files and Scripts.</strong></span> The final category of distribution content is user-provided configuration files and scripts. Files are copied, and scripts are executed, during client machine installation and updates. For more information, see <a href="#configuring-clients">Configuring Client Machines</a>.</li></ul></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id2730533"></a>Build Process</h3></div></div></div><p><span class="application">SystemBuilder</span> uses information from the <a href="#distribution_definition">distribution definition</a> to gather distribution content. It processes this information in three primary ways.</p><div class="itemizedlist"><ul type="disc"><li><p><span class="strong"><strong>Creates a configuration package.</strong></span> SystemBuilder creates a <a href="#configuration-package">configuration package</a> in RPM format. This package contains configuration files and scripts specified in the distribution definition. It also contains SystemBuilder-generated YUM update configuration. See <a href="#updating-client-machines">Updating Client Machines</a> for more information on SystemBuilder-generated YUM configuration.</p><p>During this step, SystemBuilder also creates a <a href="#distribution-data-file">distribution data file</a>, if one does not exist, in the same folder as the distribution definition. The file has a <code class="filename">.dat</code> extension. SystemBuilder uses the data file to track and increment the configuration package release number.</p></li><li><span class="strong"><strong>Assembles a package repository.</strong></span> Using the distribution definition, SystemBuilder compiles a list of required packages. It then resolves package dependencies, downloads packages, adds the configuration package (mentioned in the previous item) and creates a complete, self-contained package repository. The package repository is used during network installations to client machines. It is also used during client machine updates.</li><li><span class="strong"><strong>Customizes network install images.</strong></span> SystemBuilder downloads network installation images from the base operating system and modifies them to include distribution-specific information. By default, SystemBuilder configures the installer program contained within the images to access distribution content from the distribution's <a href="#download-location">download location</a>. This allows client machines to be installed over the network without needing to provide the download location manually at installation time. SystemBuilder can also be used to completely automate client installations. See <a href="#automating-installations">Section 5.2 Automating Installations</a> for more information.</li></ul></div><p><span class="application">SystemBuilder</span> stores distribution content, both input and generated, in the cache folder, by default <code class="filename">/var/cache/systembuilder/</code>. It reuses information from the cache on subsequent runs, where possible, to improve build performance.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id2743252"></a>Build Output</h3></div></div></div><p>SystemBuilder outputs a complete distribution, a distribution data file and a log file.</p><div class="itemizedlist"><ul type="disc"><li><span class="strong"><strong>Distribution.</strong></span> The primary output of the build process is a complete distribution containing distribution-specific network installation images and a package repository. Using network installation images you can deploy the distribution to one or more physical or virtual client machines. See <a href="#installing-client-machines">Installing Client Machines</a> for more information. The distribution package repository supports client machine updates using YUM. The section <a href="#updating-client-machines">Updating Client Machines</a> provides an overview of SystemBuilder's client machine update features.</li><li><span class="strong"><strong>Distribution Data File.</strong></span> As mentioned above, SystemBuilder creates a <a href="#distribution-data-file">distribution data file</a> during the build process. This file is used to track and increment the release number of the configuration package.</li><li><span class="strong"><strong>SystemBuilder Log File.</strong></span> SystemBuilder sends output both to the screen and to a log file, located by default at <code class="filename">/var/log/systembuilder.log.</code></li></ul></div></div><p>In summary, SystemBuilder is a production distribution life cycle manager
  for use in defining, building and maintaining distributions that can
  be easily installed and updated on physical and virtual machines using
  industry standard deployment and update tools.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="installing-client-machines"></a>2.3. Installing Client Machines</h2></div></div></div><p>Because 
  <span class="application">SystemBuilder</span> creates
  distributions in a standard operating system format, client machines can be
  deployed using the same tools and methods as used for
  <span class="application">Red Hat Enterprise Linux</span> (RHEL) and 
  <span class="application">CentOS</span>.</p><div class="itemizedlist"><ul type="disc"><li>Network installation using a network interface card (NIC) with Pre-Execution Environment (PXE) support, CD/DVD or USB boot media.</li><li>CD/DVD installation (for use in environments with limited network connectivity).</li><li>Virtual machine installation using the virt-manager or virt-install tools provided with RHEL and CentOS 5.4 operating systems</li></ul></div><p>See the section on <a href="#installing-physical-and-virtual-clients">Installing Physical and Virtual Clients</a> for complete information.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="updating-client-machines"></a>2.4. Updating Client Machines</h2></div></div></div><p>SystemBuilder makes it easy to keep installed client machines up to date with changes to the distribution. This is done using automated builds and the <span class="application">YUM Sync Plugin</span>.</p><p><span class="strong"><strong>Automated Builds.</strong></span> SystemBuilder runs from the command line with no need for manual intervention. Because of this, SystemBuilder can be automated to refresh distributions on a periodic basis, e.g. nightly, using job scheduling programs such as <span><strong class="command">cron</strong></span>. Doing so has two benefits. First, it ensures that your distributions are current and ready to install or reinstall new clients, whenever the need occurs. Second, it allows your distributions to serve as "master repositories", providing ongoing updates to client machines via the YUM Sync Plugin tool. More information on using <span><strong class="command">cron</strong></span> to automate SystemBuilder builds is available in Chapter 4, Creating a Production Environment.</p><div class="mediaobject"><img src="systembuilder_updates.png" /><div class="caption"><p>SystemBuilder Update Model</p></div></div><p><span class="strong"><strong>YUM Sync Plugin.</strong></span> The SystemBuilder product provides a small extension to YUM, the <span class="emphasis"><em>YUM Sync Plugin</em></span> that allows keeping installed clients up to date with changes in the distribution or "master" repository. The YUM SyncPlugin is installed to client machines by default via the <a href="#configuration-package">configuration package</a>. The plugin performs two functions:</p><div class="itemizedlist"><ul type="disc"><li><p>Establishes the <a href="#distribution-repository">distribution repository</a> as the master repository for the client system. This disables all other default package repositories, allowing the plugin to get an accurate list of what packages <span class="emphasis"><em>should be installed</em></span> on the system using packages available in the distribution repository.</p></li><li><p>Provides a new command line argument <span class="emphasis"><em>sync</em></span> for use with YUM:</p><div class="informalexample"><p><span><strong class="command"># yum sync</strong></span></p></div><p>The <span class="emphasis"><em>sync</em></span> argument behaves similarly to the YUM <span class="emphasis"><em>update</em></span> argument, with two additions: 1) it adds packages from the distribution repository that are not installed on the client, and 2) it removes packages from the client that do not exist in the repository.</p></li></ul></div><p>See the section on <a href="#updating-a-client-machine">Updating a Client Machine</a> for details and an example of YUM Sync Plugin usage.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id2743557"></a>2.5. SystemBuilder Files and Folders</h2></div></div></div><p><span class="application">SystemBuilder</span> has several
  key files and folders, listed in the table below.</p><div class="informaltable"><table border="1"><colgroup><col /><col /></colgroup><tbody><tr><td>/etc/systembuilder/systembuilder.conf</td><td><span class="application">SystemBuilder</span> looks
            for this file to locate systembuilder configuration. See the
            systembuilder and systembuilder.conf man pages for more information.
            This file is optional and does not exist in the default SystemBuilder
            installation.</td></tr><tr><td>/usr/bin/systembuilder</td><td>The <span><strong class="command">systembuilder</strong></span> command.</td></tr><tr><td>/usr/lib/python<code class="varname">$version</code>/site-packages/systembuilder</td><td><table width="100%" border="0"><colgroup><col /></colgroup><tbody><tr><td>Python code for <span class="application">SystemBuilder</span>, where
                  <code class="varname">$version</code> is the <span class="application">Python</span> version.</td></tr></tbody></table></td></tr><tr><td>/usr/share/doc/systembuilder-<code class="varname">$version</code></td><td>Documentation for <span class="application">SystemBuilder</span>, where
            <code class="varname">$version</code> is the <span class="application">SystemBuilder</span> version.</td></tr><tr><td>/usr/share/systembuilder/schemas</td><td>Relax NG schemas for distribution definition validation.
            </td></tr><tr><td>/var/cache/systembuilder/</td><td>SystemBuilder stores cached content in this folder. See
            the systembuilder and systembuilder.conf man pages for cache-related
            options.
            </td></tr><tr><td>/var/log/systembuilder.log</td><td>SystemBuilder's default log file.</td></tr><tr><td>/var/www/html/distributions/</td><td>SystemBuilder publishes completed distributions to  
            this folder by default. An alternative location can be specified on
            a per distribution basis within a distribution definition.
            </td></tr></tbody></table></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id2782785"></a>2.6. Glossary of Terms</h2></div></div></div><p>These terms are specific to the SystemBuilder environment, not to Linux or
  applications that run on Linux. They are arranged in alphabetical order.</p><div class="variablelist"><dl><dt><a id="id"></a><span class="term"><span class="strong"><strong><code class="varname">$ID</code></strong></span></span></dt><dd><p>The id for a distribution. The default value consists of the
          <span class="emphasis"><em>/name</em></span>, <span class="emphasis"><em>/version</em></span> and
          <span class="emphasis"><em>/arch</em></span> child elements of the
          <span class="emphasis"><em>main</em></span> element in the distribution definition in the format
          <code class="varname">$NAME</code>-<code class="varname">$VERSION</code>-<code class="varname">$ARCH</code>.</p></dd><dt><a id="build-system"></a><span class="term"><span class="strong"><strong>build machine</strong></span></span></dt><dd><p>The server on which <span class="application">SystemBuilder</span> is installed.</p></dd><dt><a id="client-system"></a><span class="term"><span class="strong"><strong>client machine</strong></span></span></dt><dd><p>The target system on which distribution contents are installed.
          </p></dd><dt><a id="configuration-package"></a><span class="term"><span class="strong"><strong>configuration package</strong></span></span></dt><dd><p>An RPM package created by SystemBuilder during the build process. This package contains the <span class="application">YUM</span> sync plugin, SystemBuilder created YUM configuration, and user-specified configuration files and scripts. The name of the configuration package is in the following format, where $NAME and $VERSION are taken from the <span class="emphasis"><em>name</em></span>, and <span class="emphasis"><em>version</em></span> elements in the distribution definition and $RELEASE is taken from the <a href="#distribution-data-file">distribution data file</a>.
          </p><div class="informalexample"><code class="filename">$NAME-config-$VERSION-$RELEASE.noarch.rpm</code></div><p>
          </p><p>For example, given a distribution with the name "samba-server" and version "5", the first time SystemBuilder creates the distribution, the configuration package will be named as follows:</p><div class="informalexample"><code class="filename">samba-server-config-5-1.noarch.rpm</code></div><p>
          </p><p>The release number "1" will be written to the distribution data file. When configuration changes in the future, e.g. when files or scripts are added, deleted or modified, SystemBuilder will increment the release number by 1, create a new configuration package (in this case samba-server-config-5-2.noarch.rpm), and store the new release number ("2") in the distribution data file. The incremented version number allows installed client machines to determine that a new configuration package is available for download and installation.</p><p>For more information on what the configuration package contains
          and how to customize its contents, see the section on 
          <span class="emphasis"><em>config</em></span> in the Distribution Definition File 
          Reference.</p></dd><dt><a id="ddfr"></a><span class="term"><span class="strong"><strong>DDFR</strong></span></span></dt><dd><p>"Distribution Definition File Reference," the rules of syntax for
          the distribution definition.</p></dd><dt><a id="distribution_definition"></a><span class="term"><span class="strong"><strong>distribution definition</strong></span></span></dt><dd><p>The information SystemBuilder uses to build, configure and store
          a distribution. By convention the text file uses the <code class="filename">.distribution</code> extension. The file uses XML
          tagging as defined in the DDFR.</p></dd><dt><a id="distribution-data-file"></a><span class="term"><span class="strong"><strong>distribution data file</strong></span></span></dt><dd><p>A file SystemBuilder creates to track and increment the release number of the distribution's <a href="#configuration-package">configuration package</a>. This file is created in the same folder as the distribution definition, using the same filename, with a <code class="filename">.dat</code> file extension. For example, given the full path to a distribution definition:</p><div class="informalexample"><code class="filename">/~/samba-server.distribution</code></div><p>
          </p><p>SystemBuilder will create the data file as follows:</p><div class="informalexample"><code class="filename">/~/samba-server.distribution.dat</code></div><p>
          </p><p>Care should be taken not to delete this file. Doing so will cause the release number of the configuration package to restart at "1". As a result, updated configuration packages will fail to be downloaded and installed during client machine updates.</p></dd><dt><a id="download-location"></a><span class="term"><span class="strong"><strong>download location</strong></span></span></dt><dd><p>The web location (URL) for downloading distribution content. SystemBuilder uses this location during the build process for two purposes, for creating YUM client configuration (included in the <a href="#configuration-package">configuration package</a>), and for customizing network install images. By default the download location is as follows, where $IP_ADDRESS is the address of the build machine, and $ID is the distribution id.</p><div class="informalexample"><code class="filename">http://$IP_ADDRESS/distributions/$ID</code></div><p>For example, if the IP Address for the build machine is <code class="filename">192.168.1.5</code> and the distribution id is <span class="emphasis"><em>samba-server-5-i386</em></span> the download location is as follows:</p><div class="informalexample"><code class="filename">http://192.168.1.5/distributions/samba-server-5-i386</code></div><p>The download location is configurable using the <span class="emphasis"><em>publish</em></span> element of the distribution definition. See the DDFR for information on the publish element. See also <a href="#production-definitions">Production Definitions</a> for a discussion on using download locations in a production environment.</p></dd><dt><a id="distribution-repository"></a><span class="term"><span class="strong"><strong>distribution repository</strong></span></span></dt><dd><p>RPM package repository created during the distribution build
          process. Provides packages for use during client machine installations
          and updates. Can be accessed over the network from the 
          <code class="filename">os</code> folder of the 
          <a href="#download-location">download location</a>.</p></dd><dt><span class="term"><span class="strong"><strong>production server</strong></span></span></dt><dd><p>Within a <span class="application">SystemBuilder</span>
          development - staging - production environment, it serves as the
          download server from which clients retrieve the distribution contents
          to install.</p></dd><dt><span class="term"><span class="strong"><strong>staging server</strong></span></span></dt><dd><p>The server within a development - staging - production
          environment that uses <span class="application">SystemBuilder</span> to build production-ready
          distributions for migration to the production, or
          download, server.</p></dd><dt><a id="yum-sync-plugin"></a><span class="term"><span class="strong"><strong>YUM Sync Plugin</strong></span></span></dt><dd><p>A <span class="application">YUM</span> plugin provided by SystemBuilder that allows synchronizing packages on client machines with packages in the <a href="#distribution-repository">distribution repository</a>. The plugin is included by default in the <a href="#configuration-package">configuration package</a>, which serves as the mechanism for installing it on client machines. The plugin establishes the distribution repository as the <span class="emphasis"><em>master repository</em></span>, disables all non-master repositories, and provides a new argument, <span class="emphasis"><em>sync</em></span>, to YUM. Help for the <span class="emphasis"><em>sync</em></span> argument is available on client machines using the <span><strong class="command">yum help</strong></span> command. Running <span><strong class="command">yum sync</strong></span> allows YUM to calculate package additions and removals based on packages available in the distribution repository. For more information, see the section on <a href="#updating-client-machines">Updating Client Machines</a>.</p></dd></dl></div></div></div><div class="chapter" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title"><a id="id2783344"></a>Chapter 3. Building a Distribution</h2></div></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="configuring-a-build-machine"></a>3.1. Configuring a Build Machine</h2></div></div></div><p><span class="application">SystemBuilder</span> is designed to work
  in a networked environment. You can install <span class="application">SystemBuilder</span> on a <span class="application">Linux</span> system operating with <span class="application">CentOS</span> 5 or <span class="application">Red
  Hat Enterprise Linux</span> 5.</p><p>Recent advances in virtualization, including the introduction of a Kernel-based Virtual Machine solution (KVM), have made it both easy and compelling to use virtual machines for testing client installation and updates. For this reason, we recommend installing SystemBuilder on a system installed with the x86_64 version <span class="application">Red Hat Enterprise Linux</span> 5.4 or <span class="application">CentOS</span> 5.4, using one of the following architectures:</p><div class="itemizedlist"><ul type="disc"><li>an Intel processor with the Intel VT and the Intel 64 extensions, or</li><li>an AMD processor with the AMD-V and the AMD64 extensions.</li></ul></div><p>This document will focus on using virtual machines a primary method
  for testing client installations and updates.</p><p>For capacity planning purposes, the machine should have a separate
  logical or physical drive for the <code class="filename">/var</code> directory. <span class="application">SystemBuilder</span> uses the <code class="filename">/var/cache/systembuilder</code> folder for caching 
  distribution contents and the <code class="filename">/var/www/html/distributions</code> folder for storing
  completed distributions. The recommended minimum drive space allocated for
  each of these folders is 15GB (30GB total). Depending upon the number and size
  of distributions created, you may need more disk space.</p><p>Disk access is another consideration. Due to the size of the files
  handled, fast disk access is preferable. To accommodate the speed
  requirements, it is best to use hard disk drives with Serial Advanced
  Technology Attachment (SATA) interfaces.</p><p>SystemBuilder makes it easy to test client machine installations and
  updates over the network directly from the build machine. To make use of this
  feature, you will need to install and configure a web server.</p><p>First, install and configure the Apache web server by completing the
  following steps as the root user.</p><div class="informalexample"><pre class="programlisting">
# yum install httpd
# service httpd start
# chkconfig --level 3 httpd on</pre></div><p>Next, modify your firewall configuration, if needed, to allow 
  www/http traffic (port 80) using the command below as the root user.</p><pre class="programlisting"># system-config-securitylevel</pre><p>To install and configure support for testing distributions using KVM-based virtual
  machines (recommended), complete these additional steps as the root user. Note the OS and system requirements specified earlier in this section.</p><p>First, install the kvm package group.</p><div class="informalexample"><pre class="programlisting">
# yum groupinstall kvm
  </pre></div><p>Next, using a text editor, modify <code class="filename">/etc/libvirt/qemu/networks/default.xml</code> to add &lt;forward mode='nat'/&gt; above &lt;bridge name='virbr0'/&gt; as follows:</p><div class="informalexample"><pre class="programlisting">
====
&lt;forward mode='nat'/&gt;
&lt;bridge name='virbr0'/&gt;
=====
  </pre></div><p>Finally, restart your system.</p><div class="informalexample"><pre class="programlisting">
# shutdown -r now
  </pre></div><p>Now you are ready to begin defining your distribution!</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id2783574"></a>3.2. Choosing a Use Case: A Samba Server</h2></div></div></div><p>For the purpose of this user guide, examples, processes and
  illustrations will focus on defining, building, deploying and updating a
  <span class="application">Samba</span> server based on
  <span class="application">CentOS 5</span>. Samba is a project of
  the <a href="http://conservancy.softwarefreedom.org/" target="_top">Software Freedom
  Conservancy</a>. Samba is a key interoperability component in a blended
  operating system environment. When installed on a Linux or Unix operating system, it enables that system
  to act like a Windows file or print server, enabling Windows users to print
  to or save files using it.</p><p>The discussions and code examples in this chapter and subsequent parts
  focus on a Samba server based on CentOS 5 that enables print and file
  services. In this chapter, the examples assume the server will be
  installed via the network directly from the build machine. The DDFR provides
  the syntax for all parent and child elements and their attributes.</p><p>Creating the <span class="application">Samba</span>
  server distribution entails several process steps. After configuring the
  <span class="application">SystemBuilder</span> build machine,
  as described in the previous chapter, you need to create a distribution
  distribution definition 
  (<code class="filename">samba-server.distribution</code>). Then
  you run <span><strong class="command">systembuilder</strong></span> to validate the file, retrieve
  the packages and build the distribution. From there you prepare the boot
  media.</p><p>The next section will explain how to define the system
  before you build it and prepare for deployment to a client
  system.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="defining-a-distribution"></a>3.3. Defining a Distribution</h2></div></div></div><p>To define your Samba distribution, you will need to do the following:</p><div class="itemizedlist"><ul type="disc"><li><p>Define some basic system information;</p></li><li><p>Select the repositories from which to download the operating
        system, the Samba RPMs and any dependency files;</p></li><li><p>Define the application groups and packages to include with the
        operating system; and</p></li><li><p>Provide configuration information.</p></li></ul></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id2783713"></a>Creating a distribution definition</h3></div></div></div><p>The first step to creating a distribution is creating the
    distribution definition. The distribution definition is a text file in XML format. It can
    be created using any text editor - vi, emacs, nano, or gedit - or 
    a dedicated XML editor, if you prefer. The tags &lt;distribution&gt; and 
    &lt;/distribution&gt; encapsulate all additional elements and attributes.
    </p><div class="informalexample"><pre class="programlisting">&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;distribution xmlns:xi="http://www.w3.org/2001/XInclude"&gt;

&lt;!-- Additional elements and attributes --&gt;

&lt;/distribution&gt;</pre></div><p>The first line, beginning in "&lt;?xml", identifies the file
    as an XML file. This line is not required, but is a good practice for
    compatibility with future XML format changes.</p><p>Likewise, the "xmlns:xi..." attribute is not required on the 
    distribution element. It allows the use of xinclude statements within the
    document. XIncludes, a convenient mechanism for reusing content across 
    multiple definitions, are discussed in Chapter 4, 
    "Creating a Production Environment".</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id2783765"></a>Naming a distribution</h3></div></div></div><p>The first required element of the definition, 
    <span class="emphasis"><em>main</em></span>, includes the name of the distribution, the system
    architecture and the version. These three items make up the default
    distribution id (<code class="varname">$ID</code>), which SystemBuilder uses to create
    folders for storing the completed distribution (under 
    <code class="filename">/var/www/html/distributions</code>, by
    default) and for caching distribution content (under 
    <code class="filename">/var/cache/systembuilder</code>, by default).
    </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png" /></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>The elements can be in any order within a distribution definition
        file.</p></td></tr></table></div><p>In the example below, the distribution version will be 5, the system
    architecture will be i386, and the <code class="varname">$ID</code> will
    be <code class="filename">samba-server-5-i386</code>. </p><div class="informalexample"><pre class="programlisting">
&lt;main&gt;
  &lt;name&gt;samba-server&lt;/name&gt;
  &lt;version&gt;5&lt;/version&gt;
  &lt;arch&gt;i386&lt;/arch&gt;
&lt;/main&gt;</pre></div><p>You can override the default distribution id using an
    <span class="emphasis"><em>id</em></span> element. See the DDFR for more details about the
    <span class="emphasis"><em>main</em></span> element.</p><p>Save the file as <code class="filename">samba-server.distribution</code> before
    preceding.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png" /></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Each time you change a distribution's id, either implicitly by
        changing the <span class="emphasis"><em>name</em></span>, <span class="emphasis"><em>version</em></span> or 
        <span class="emphasis"><em>arch</em></span> elements, or explicitly by changing the
        <span class="emphasis"><em>id</em></span> element, SystemBuilder creates new folders for
        it in the publish and cache folders 
        (<span class="emphasis"><em>/var/www/html/distributions</em></span> and 
        <span class="emphasis"><em>/var/cache/systembuilder</em></span>, by default,
        respectively). To preserve hard drive space, you may wish to review 
        the publish and cache folders on occasion. Folders for obsolete
        distributions can be deleted using standard file system methods (e.g. 
        <span><strong class="command">rm -rf <span class="emphasis"><em>obsolete_folder</em></span></strong></span>).</p></td></tr></table></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="specifying-repositories"></a>Specifying repositories</h3></div></div></div><p>SystemBuilder obtains software from RPM package repositories. 
    Repositories are collections of RPMs with associated metadata files. 
    Metadata files allow applications, like 
    <span class="application">SystemBuilder</span>, to learn about packages in the
    repository, without having to download and inspect each package
    individually. Access to package repositories may be either public or
    restricted. Common public repositories include CentOS 5 Base, CentOS 5 
    Updates, and Extra Packages for Enterprise Linux (EPEL). Access to Red Hat
    Enterprise Linux 5 repositories is restricted. Administrators can create
    custom package repositories using the <span class="application">createrepo</span>
    utility.</p><p>In this section, you will define the repositories to be used for your
    distribution.</p><div class="itemizedlist"><ul type="disc"><li><p>Operating System Base Repository. For CentOS, this will be
      a public or local mirror. For Red Hat Enterprise Linux, an install tree
      created using an ISO image file. This repository is unique in that it also
      contains <code class="filename">isolinux</code> and 
      <code class="filename">images</code> folders. Your definition
      must include an operating system base repository.</p></li><li><p>Operating System Update Repositories. For CentOS, again
      this will be a public or local mirror. For Red Hat Enterprise Network, a
      channel within Red Hat Network. Typically, your definition will include
      both base and updates repositories.</p></li><li><p>Additional Repositories. Your distribution may include any
      number of additional public or private repositories.</p></li></ul></div><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="images/important.png" /></td><th align="left">Important</th></tr><tr><td align="left" valign="top"><p>You must include a repository definition for the base operating
        system. This repository must contain 
        <code class="filename">isolinux</code> and 
        <code class="filename">images</code> folders.</p></td></tr></table></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="id2784004"></a>CentOS repositories</h4></div></div></div><p>This example directs SystemBuilder to use public mirrors to access
      the CentOS 5 base and updates repositories for the i386 architecture.
      </p><div class="informalexample"><pre class="programlisting">
&lt;repos&gt;

  &lt;repo id="base"&gt;
    &lt;name&gt;CentOS-5-Base&lt;/name&gt;
    &lt;baseurl&gt;http://mirror.centos.org/centos/5/os/i386/&lt;/baseurl&gt;
  &lt;/repo&gt;

  &lt;repo id="updates"&gt;
    &lt;name&gt;CentOS-5-Updates&lt;/name&gt;
    &lt;baseurl&gt;http://mirror.centos.org/centos/5/updates/i386/&lt;/baseurl&gt;
  &lt;/repo&gt;

&lt;/repos&gt;</pre></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="id2784032"></a>Red Hat Enterprise Linux repositories</h4></div></div></div><p>
      Prior to using SystemBuilder to access Red Hat Enterprise Linux
      repositories, you will need to complete the following steps:</p><div class="itemizedlist"><ul type="disc"><li><p>Create a Red Hat Enterprise Linux 5 install tree. This
        can be accomplished by downloading an ISO image (a single DVD image is
        recommended for easier mounting) from Red Hat Network and using the 
        <span><strong class="command">mount -o loop</strong></span> command to mount the 
        <code class="filename">.iso</code> to a folder location. See the <span class="emphasis"><em>Red
        Hat Enterprise Linux 5 Installation Guide</em></span>, under the topic
        <span class="emphasis"><em>Preparing for a Network Installation</em></span>, for more
        information.</p></li><li><p>Create a systemid for accessing updates from RHN. This
        step requires an available subscription to Red Hat Enterprise Linux. See
        the Red Hat web site for purchase information. Once you have an 
        available subscription, install Red Hat Enterprise Linux 5 in the
        desired architecture version (i386 or x86_64) onto a client system.
        Register the system to Red Hat Network during installation, or first
        boot, or later using the <span><strong class="command">rhn_register</strong></span> command. Once
        the system has successfully registered with RHN, a systemid file will
        be created in the <code class="filename">/etc/sysconfig/</code>
        folder of the machine. This is the file you will use to configure
        SystemBuilder to access software from RHN. You may copy this file to the
        SystemBuilder build machine if necessary. Note, to ensure the systemid
        has access to the software desired for your distribution, you can use
        the Red Hat Network web user interface to locate the system, and view
        and alter it's channel subscriptions.</p></li></ul></div><p>After the above steps are completed, you are ready to specify base
      and updates repositories for Red Hat Enterprise Linux.</p><p>The base repository will point to the Red Hat Enterprise Linux
      install tree, created in the first step above.  In the example below, this
      is located at <code class="filename">http://www.examplecompany.com/
      install_server/redhat/enterprise/5/en/os/i386/</code>. This location
      must contain <code class="filename">isolinux</code> and 
      <code class="filename">images</code> folders.</p><p>The update repository will point to the subscribed channel in RHN
      using a custom <code class="filename">rhn://</code> protocol in the following
      format:</p><p><span><strong class="command">rhn://[$rhnhost]/$rhnchannel/</strong></span></p><p>where $rhnhost is the hostname of the server to contact and
      $rhnchannel is the name of the RHN channel from which to obtain packages.
      If not specified, $rhnhost defaults to a public Red Hat Network server at
      xmlrpc.rhn.redhat.com. Valid $rhnchannel values include:

        </p><div class="itemizedlist"><ul type="disc"><li>rhel-i386-server-5</li><li>rhel-x86_64-server-5</li></ul></div><p>
      </p><p>In the following example, SystemBuilder will contact the RHN server
      located at <code class="filename">xmlrpc.rhn.examplecompany.com
      </code> and request packages from the 
      <code class="filename">rhel-i386-server-5</code> software channel.</p><p>
      </p><div class="informalexample"><pre class="programlisting">
&lt;repos&gt;

  &lt;repo id="base"&gt;
    &lt;name&gt;Red Hat Enterprise Linux - Base&lt;/name&gt;
    &lt;baseurl&gt;http://www.examplecompany.com/install_server/redhat/enterprise/
            5/en/os/i386&lt;/baseurl&gt;
  &lt;/repo&gt;

  &lt;repo id="updates"&gt;
    &lt;name&gt;Red Hat Enterprise Linux - Updates&lt;/name&gt;
    &lt;baseurl&gt;rhn://xmlrpc.rhn.examplecompany.com/rhel-i386-server-5&lt;/baseurl&gt;
    &lt;systemid&gt;systemid-5Server-i386&lt;/systemid&gt;
  &lt;/repo&gt;

&lt;/repos&gt; 
      </pre></div><p>
      </p></div><p>Now that you've identified package repositories, you are ready
    to start including packages.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id2784226"></a>Specifying packages</h3></div></div></div><p>Once you have defined your repositories, you specify the software
    packages and groups to include. Use the <span class="emphasis"><em>packages</em></span>
    top-level element to accomplish this.</p><p>The example below includes package groups for the <span class="application">Samba</span> application and related tools plus an
    X Window System.</p><div class="informalexample"><pre class="programlisting">
&lt;packages&gt;
  &lt;group&gt;core&lt;/group&gt;
  &lt;group&gt;base&lt;/group&gt;
  &lt;group&gt;base-x&lt;/group&gt;
  &lt;group&gt;gnome-desktop&lt;/group&gt;
  &lt;group&gt;admin-tools&lt;/group&gt;
  &lt;group&gt;smb-server&lt;/group&gt;
&lt;/packages&gt;  </pre></div><p>The distribution will include the <span class="application">GNOME</span> graphical user interface (GUI) and
    common system administration tools.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="configuring-clients"></a>Configuring client machines</h3></div></div></div><p>The final step for your samba-server definition is to specify 
    configuration for client machines. 
    <span class="application">SystemBuilder</span> allows you to deploy
    and update client machine configuration in the same manner as you deploy and update 
    individual software components, using an RPM package. This simplifies your 
    tasks as a system administrator by allowing you to manage software and 
    configuration using uniform tools and processes. Creating RPM packages 
    manually can be cumbersome and time consuming. 
    <span class="application">SystemBuilder</span> makes it easy by 
    creating the <a href="#configuration-package">configuration package</a> automatically during the build process, based 
    on information you provide in the distribution definition.</p><p>Using the <span class="emphasis"><em>config</em></span> element, you can complete the
    following:

    </p><div class="itemizedlist"><ul type="disc"><li>Configure <span class="application">YUM</span>.
      </li><li>Install files and folders, either as new files or to replace files installed by other packages.</li><li>Run scripts that perform actions when RPM packages are installed
      or uninstalled.</li><li>Require packages to be installed prior to installing the configuration package. This prevents your files from being overwritten, and ensures that your scripts operate as expected.</li></ul></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="id2784359"></a>Configuring updates</h4></div></div></div><p>SystemBuilder creates a configuration package by default, even if 
      no <span class="emphasis"><em>config</em></span> element is specified in the definition. In
      this case, the configuration package performs just two actions:

      </p><div class="itemizedlist"><ul type="disc"><li>Installs a plugin module for YUM that allows synchronizing 
        packages on the client machine with packages in the distribution
        repository. See <a href="#updating-client-machines">Updating Client Machines</a> for more
        information on the 
        <span class="application">YUM Sync Plugin</span>.</li><li>Installs a repository definition for the 
        <a href="#distribution-repository">distribution repository</a>. Use the 
        <span><strong class="command">man yum.conf</strong></span> command for more information on YUM 
        repository definitions. For the samba-server distribution, the file will
        be installed at <code class="filename">/etc/yum.repos.d/samba-server.repo</code>.
        </li></ul></div><p>
      </p><p>The sync plugin can be disabled on individual client machines using 
      the <code class="filename">/etc/yum/yumplugin.d/sync.conf</code> file. The sync 
      plugin can be excluded from the configuration package altogether using
      the <span class="emphasis"><em>config/updates</em></span> element. See the DDFR for more 
      information on <span class="application">YUM</span> update 
      configuration using the <span class="emphasis"><em>/config/updates</em></span> element.
      </p><p>For the samba-server example, you will use the default update
       settings.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="id2784452"></a>Installing files</h4></div></div></div><p>The <span class="emphasis"><em>config</em></span> element allows you to specify files to be installed at certain locations on the client system. For the samba-server distribution, you will install two files, a <code class="filename">smb.conf</code> file for configuring the samba server, and a <code class="filename">yum-sync.sh</code> cron script file for executing the <span><strong class="command">yum sync</strong></span> command, provided by the YUM Sync Plugin, on a daily basis.</p><p>First, create a basic smb.conf file containing the following content. For this example we are configuring the samba server to provide anonymous, read-only access to content in the client machine's <code class="filename">/public</code> folder. </p><div class="informalexample"><pre class="programlisting">
[global]
  workgroup = WORKGROUP
  netbios name = SAMBA
  security = share

[public]
  comment = Public
  path = /public
  read only = no
  guest only = yes
        </pre></div><p>Save the smb.conf file in the same folder as the <code class="filename">samba-server.distribution.</code></p><p>Next, add the following section to your samba-server.distribution file:</p><div class="informalexample"><pre class="programlisting">
&lt;config&gt;

  &lt;!-- samba configuration --&gt;
  &lt;files destdir="/etc/samba" mode="644"&gt;smb.conf&lt;/files&gt;

  &lt;!-- yum configuration --&gt;
  &lt;files destname="yum-sync.cron" destdir="/etc/cron.daily" mode="644"
  content="text"&gt;
#!/bin/sh
/usr/bin/yum sync
  &lt;/files&gt;

&lt;/config&gt;
        </pre></div><p>The example above includes two <span class="emphasis"><em>files</em></span> elements. The first element directs SystemBuilder to locate a file named smb.conf in the same folder as the distribution definition, download it, include it in the configuration package for installation to the <code class="filename">/etc/samba</code> folder with the file mode "644". The second element directs SystemBuilder to create a new file named <code class="filename">yum-sync.cron</code>, containing the text supplied between the &lt;files&gt; and &lt;/files&gt; tags, and include it configuration package for installation to the <code class="filename">/etc/cron.daily</code> folder with the mode "644".</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png" /></td><th align="left">Note</th></tr><tr><td align="left" valign="top">SystemBuilder resolves all paths in the definition relative to the definition's folder location.</td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png" /></td><th align="left">Note</th></tr><tr><td align="left" valign="top">The attribute value <span class="emphasis"><em>content="text"</em></span> provides a convenient way to include short files and scripts without needing to create and manage separate files on disk. Larger files can also be created this way, however, this makes the definition more difficult to read.</td></tr></table></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="id2784592"></a>Executing scripts</h4></div></div></div><p>The <span class="emphasis"><em>config</em></span> element also allows you to run scripts when packages are installed and uninstalled.</p><p>For the samba-server example, let's include a script to restart the samba daemon each time the configuration package is installed or updated.</p><div class="informalexample"><pre class="programlisting">
&lt;config&gt;

  ...

  &lt;script type="post" content="text"&gt;service smb restart&lt;/script&gt;

&lt;/config&gt;
        </pre></div><p>Scripts are discussed in more detail under <a href="#using-scripts-and-triggers">Using Scripts and Triggers</a>.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="id2784631"></a>Requiring Packages</h4></div></div></div><p>Using the <span class="emphasis"><em>requires</em></span> element you can specify packages that must be installed prior to installing the configuration package, for example, so that your scripts will execute as expected.</p><p>For the samba-server example, the <span class="emphasis"><em>samba</em></span> package is required to enable the command <span><strong class="command">service smb restart</strong></span> used in the <span class="emphasis"><em>script</em></span> element above.</p><div class="informalexample"><pre class="programlisting">
&lt;config&gt;
  ...

  &lt;requires&gt;samba&lt;/requires&gt;

&lt;/config&gt;
        </pre></div></div><p>For more information on child elements of <span class="emphasis"><em>config</em></span>,
    see the <span class="emphasis"><em>config</em></span> element in the DDFR.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id2784687"></a>Validating a definition</h3></div></div></div><p>Your complete samba-server distribution should now look as follows:</p><div class="informalexample"><pre class="programlisting">
&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;distribution xmlns:xi="http://www.w3.org/2001/XInclude"&gt;

&lt;main&gt;
  &lt;name&gt;samba-server&lt;/name&gt;
  &lt;version&gt;5&lt;/version&gt;
  &lt;arch&gt;i386&lt;/arch&gt;
&lt;/main&gt;

&lt;repos&gt;
  &lt;repo id="base"&gt;
    &lt;name&gt;CentOS-5-Base&lt;/name&gt;
    &lt;baseurl&gt;http://mirror.centos.org/centos/5/os/i386/&lt;/baseurl&gt;
  &lt;/repo&gt;
  &lt;repo id="updates"&gt;
    &lt;name&gt;CentOS-5-Updates&lt;/name&gt;
    &lt;baseurl&gt;http://mirror.centos.org/centos/5/updates/i386/&lt;/baseurl&gt;
  &lt;/repo&gt;
&lt;/repos&gt;

&lt;packages&gt;
  &lt;group&gt;core&lt;/group&gt;
  &lt;group&gt;base&lt;/group&gt;
  &lt;group&gt;base-x&lt;/group&gt;
  &lt;group&gt;gnome-desktop&lt;/group&gt;
  &lt;group&gt;admin-tools&lt;/group&gt;
  &lt;group&gt;smb-server&lt;/group&gt;
&lt;/packages&gt;  

&lt;config&gt;
  &lt;!-- samba configuration --&gt;
  &lt;files destdir="/etc/samba" mode="644"&gt;smb.conf&lt;/files&gt;
  &lt;script type="post" content="text"&gt;service smb restart&lt;/script&gt;
  &lt;requires&gt;samba&lt;/requires&gt;

  &lt;!-- yum configuration --&gt;
  &lt;files destname="yum-sync.cron" destdir="/etc/cron.daily" mode="644"
  content="text"&gt;
#!/bin/sh
/usr/bin/yum sync
  &lt;/files&gt;

&lt;/config&gt;

&lt;/distribution&gt;
      </pre></div><p>Once your definition is complete, you can use 
    <span class="application">SystemBuilder</span> to validate
    it's syntax.</p><p>
    </p><div class="informalexample"><pre class="programlisting">#systembuilder --validate-only samba-server.distribution</pre></div><p>
    </p><p>If your definition is valid, 
    <span class="application">SystemBuilder</span> will display the 
    complete definition and exit. Otherwise, it will display error information,
    allowing you to locate and correct issues.</p></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id2784768"></a>3.4. Building a Distribution</h2></div></div></div><p>Now that you have defined your distribution, you use the
  <span><strong class="command">systembuilder</strong></span> command to build it. The basic command validates the 
  distribution definition syntax, creates the distribution, and records 
  process results. The default level of screen output includes errors, build
  status and file download and creation status. SystemBuilder also
  sends this output to the log file, by default 
  <code class="filename">/var/log/systembuilder.log</code>. If a critical error
  occurs, SystemBuilder includes detailed error information in the log file.</p><p>The initial build of a distribution can be time consuming, on the order
  of several minutes to an hour or more. Initial build time depends on a number
  of variables including the location of package repositories (local or remote), 
  network connection speed, the number of packages included in the distribution, 
  and the amount of content that can be reused from the SystemBuilder shared 
  cache. Subsequent builds complete in much less time, often 1-2 minutes, 
  depending on the level and type of change since the previous build.</p><p>To run your build, enter the command below:</p><div class="informalexample"><pre class="programlisting">#systembuilder samba-server.distribution</pre></div><p>The output for an initial run details all the steps
  for downloading packages, checking package dependencies and creating
  images. If there are any errors, <span class="application">SystemBuilder</span> notes those and, in many cases,
  halts the process. See Appendix A for an example of a successful first-build
  output.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png" /></td><th align="left">Note</th></tr><tr><td align="left" valign="top">If your distribution uses RHN channels as repositories, SystemBuilder may occasionally report errors such as the following while downloading or verifying repository metadata:

  <pre class="programlisting">[repos] long int too large to convert to int</pre> 

This can happen when SystemBuilder receives invalid data from RHN. (Typically this occurs when data is being replicated across RHN servers). The error may be corrected by running SystemBuilder again, either immediately or after waiting several minutes.</td></tr></table></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="installing-physical-and-virtual-clients"></a>3.5. Installing Physical and Virtual Clients</h2></div></div></div><p>Deployment to a client machine is the next step. Because 
  <span class="application">SystemBuilder</span> creates
  distributions in a standard operating system format, client machines can be
  deployed using the same tools and methods as used for 
  <span class="application">Red Hat Enterprise Linux</span> and
  <span class="application">CentOS</span>.</p><p>For the samba-server example, we will discuss two installation methods. In the first method, you will install to a physical machine using a bootable CD or DVD. In the second, you will install to a virtual machine.</p><p>The methods discussed below are only two of several possible methods for
  installing your distribution to physical or virtual client machines. See the   
  <span class="emphasis"><em>Red Hat Enterprise Linux 5 Installation Guide</em></span> and 
  <span class="emphasis"><em>Red Hat Enterprise Linux 5 Virtualization Guide</em></span> for 
  additional methods and complete information.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id2784918"></a>Installing to a Physical Machine</h3></div></div></div><p>In this method, you will use a network install image (<code class="filename">boot.iso</code>)
  to create an installation CD or DVD. To start the installation, you will boot
  the client machine using the CD/DVD. The installer program contained on the
  CD/DVD will then use the network to download files from the distribution URL
  to complete the installation. To complete this example, you must have
  configured the build machine as a web server, as described in 
  <a href="#configuring-a-build-machine">Configuring a Build Machine</a> </p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="id2784943"></a>Creating boot media</h4></div></div></div><p>After <span class="application">SystemBuilder</span>
      completes the build, you  will find your distribution in a folder beneath
      the <code class="filename">/var/www/html/distributions</code> 
      default directory on the download server. The folder name will be
      the distribution <code class="varname">$ID</code>, e.g.
      <code class="filename">samba-server-5-i386</code>.</p><p>To install to a client machine, you burn a boot image to a separate
      media. For this example, burn the <code class="filename">boot.iso</code> image 
      (found in the <code class="filename">/os/images</code> folder 
      below the <code class="filename">/distributions/samba-server-5-i386
      </code> folder, above) to a CD or DVD.</p><p>To burn the image, one option is to run the
      <span><strong class="command">cdrecord</strong></span> command from the <code class="filename">/os/images</code> folder as illustrated below. Note
      the scanbus number sequence, then record the ISO image onto a CD or DVD
      and label the media, including the number sequence. The number sequence,
      e.g. 1,0,0, may differ from machine to machine.</p><div class="informalexample"><pre class="programlisting"># cdrecord -scanbus -dev=ATA
# cdrecord -v -dao dev=ATA:1,0,0 boot.iso</pre></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="id2785037"></a>Booting a client machine</h4></div></div></div><p>Now you are ready to create your client. Place the boot media into the CD/DVD drive of the client machine. Now restart the client, booting from the CD or DVD. The boot process will load an installation program, or <span class="emphasis"><em>installer</em></span> from the CD or DVD into system memory. The installer will complete the installation, retrieving additional content over the network from the <a href="#download-location">download location</a>. When the installation successfully completes, the client system will reboot and display a login prompt. You can check the <code class="filename">sys.log</code> file for installation and boot process log information.</p></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id2785070"></a>Installing to a Virtual Machine</h3></div></div></div><p>Machine virtualization is a relatively new technology with many possibilities for simplifying system administration. In the samba-server example, we will use machine virtualization to test client installation, quickly and easily, without requiring a separate physical client machine, or the creation of physical boot media media (e.g. a CD/DVD disc as in the prior method). Distribution testing using virtual machines is convenient, even when your target clients are physical machines, as it allows you to work more efficiently during the highly iterative development and testing process. To use the method described below, you must have previously configured the build machine to meet exacting hardware, operating system, and configuration requirements. See the section on <a href="#configuring-a-build-machine">Configuring a Build Machine</a> for more information.</p><p>Once you have configured, and rebooted, your machine as described under <span class="emphasis"><em>Configuring a Build Machine</em></span>, you are ready to install a new virtual machine using either the <span><strong class="command">virt-manager</strong></span> or <span><strong class="command">virt-install</strong></span> commands. For best results, complete the process one time using virt-manager. Virt-manager provides a graphical user interface that will aid your understanding of the process and help you to ensure that your machine is configured correctly. Once you are familiar with the process, you may find it more efficient to use the command-line utility, <span class="application">virt-install</span>, to complete additional virtual machine installations.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="id2785129"></a>Using virt-manager</h4></div></div></div><p>Virt-manager provides a graphical user interface for creating and managing virtual machines. For the samba-server example, create a new virtual machine using virt-manager as follows:</p><div class="orderedlist"><ol type="1"><li>As the root user, start virt-manager by typing "<strong class="userinput"><code>virt-manager &amp;</code></strong>" at the command prompt.</li><li>Click on the row beginning with the name "localhost". This will enable the "New" button in the lower right corner of the dialog. If the new button is not available, try exiting virt-manager, switching to the root user, and restarting.</li><li>Click the "New" button. This brings up a dialog titled "Create a new virtual machine". Click the "Forward" button.</li><li>In the "Virtual Machine Name" panel, type <strong class="userinput"><code>samba-server</code></strong> as the machine name. Click the "Forward" button.</li><li>In the "Virtualization Method" panel, ensure that the "Fully Virtualized" option is active and selected. If it is greyed out, your machine may not support kernel virtualization extensions, or it may not be configured correctly. Return to the section on <a href="#configuring-a-build-machine">Configuring a Build Machine</a> for hardware and software requirements, and machine configuration instructions. Be sure to reboot the machine after following all instructions. If the "Fully Virtualized" option is active and selected, click the "Forward" button.</li><li>In the "Installation Method" panel, click the "Network Install Tree" option. Click "Forward".</li><li>In the "Installation Source" panel, type "<strong class="userinput"><code>http://$IP/distributions/samba-server-5-i386/os</code></strong>", where $IP is the IP address of the build machine, locatable by typing <strong class="userinput"><code>ifconfig eth0</code></strong> at a command prompt on the build machine.  Alternatively, if your build machine is locatable via DNS, you can enter the Fully Qualified Domain Name (FQDN) of the build machine in place of the IP address. Note, however, that you cannot enter a hostname (e.g. "myhost") that is not a FQDN (e.g. "myhost.mycompany.com"), as domain searching is not currently supported when using virtual networks. Doing so will result in an error later in the installation process ("Unable to retrieve http://myhost/distributions/samba-server/os/images/stage2.img"). Click "Forward".</li><li>In the "Storage" panel, ensure the "File (disk image)" option is selected and the value is set to <strong class="userinput"><code>/var/lib/libvirt/images/samba-server.img</code></strong>. In subsequent installations (after deleting an existing virtual machine - see <a href="#deleting-a-virtual-machine">Deleting a virtual machine</a>) virt-manager will attempt to automatically increment the image name, e.g. to <strong class="userinput"><code>/var/lib/libvirt/images/samba-server-1.img</code></strong>. To preserve disk space on the build machine, you should either reset the image name to <strong class="userinput"><code>samba-server.img</code></strong>, or make it a practice to clean out the /var/lib/libvirt/images folder on a regular basis. Click "Forward".</li><li>In the remaining panels, accept the default values and continue to click "Forward".</li><li>Click "Finish" to start the installation. If you get an error "Unable to retrieve http://$IP/distributions/samba-server-5-i386/os/stage2.img" during installation, check that 1) you have typed the url correctly, 2) you have provided an IP address or FQDN in the host portion of the URL and 3) the httpd service is running on your build machine and you have allowed port 80 traffic through the machine's firewall (see <a href="#configuring-a-build-machine">Configuring a Build Machine</a>).</li><li>Once installation completes, choose "Reboot".</li><li>In the resulting dialog, click "Run" to start the machine and test that it functions as expected.</li></ol></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="id2785288"></a>Using virt-install</h4></div></div></div><p>The <span><strong class="command">virt-install</strong></span> utility provides a command-line user interface for installing virtual machines. For the samba-server example, use virt-install to create a new virtual machine as follows. You must be the root user.</p><div class="informalexample"><pre class="programlisting">
# virt-install --accelerate --hvm --connect qemu:///system \
	--network network:default \
	--name samba-server --ram=512\
	--file=/var/lib/libvirt/images/samba-server.img \
	--file-size=4 --vnc --location=http://$IP/distributions/samba-server-5-i386/os
        </pre></div><p>The variable $IP above indicates the IP address of the build machine, locatable by typing <strong class="userinput"><code>ipconfig eth0</code></strong> at the command line.</p><p>See the section on virt-manager above for help with related common problems and error messages</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="deleting-a-virtual-machine"></a>Deleting a virtual machine</h4></div></div></div><p>While developing a new distribution, you may wish to reuse the same virtual-machine name for testing multiple iterations of the same distribution. You can do this using <span><strong class="command">virt-manager</strong></span> as follows:</p><div class="itemizedlist"><ul type="disc"><li>From the virt-manager graphical user interface, click on the line beginning "samba-server".</li><li>If the machine is currently running, choose Shutdown and/or Force Off.</li><li>Then click the "Delete" button in the lower right corner of the dialog.</li></ul></div></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id2785371"></a>Verifying the Installation</h3></div></div></div><p>One quick test to make sure the install completed correctly, on either
    a physical or virtual client, is
    to verify the contents of the <code class="filename">smb.conf</code>
    installed on the client machine. It should match the one provided in the
    distribution definition.</p><p>Congratulations! You now have a Samba server installed on a CentOS 5
    client machine.</p></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id2785395"></a>3.6. Updating a Distribution</h2></div></div></div><p>SystemBuilder makes it easy to keep your distribution up to date over 
  time by simply rerunning the <span><strong class="command">systembuilder</strong></span> command. 
  When SystemBuilder runs, it looks for changes in build input, or in the 
  distribution definition, and makes adjustments to the published
  distribution as necessary.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id2785414"></a>Running <span><strong class="command">systembuilder</strong></span> to check for repository
    updates</h3></div></div></div><p>To include updated packages from the repositories, execute
    <span><strong class="command">systembuilder</strong></span> with the
    <code class="filename">samba-server.distribution</code> file. <span class="application"> Rerunning <span><strong class="command">systembuilder</strong></span> with the same
    <code class="filename">.distribution</code> file will dramatically
    reduce the build time, assuming there are no changes to the file's
    contents. SystemBuilder</span> uses a cache of the packages and verifies the
    cache contents against the metadata for the repository and the groups. The
    screen output below shows the results of a build with no changes to the
    <code class="filename">samba-server.distribution</code> file and no updates to the
    repositories.</p><pre class="screen">Reading '/home/systembuilder/samba-server.distribution'
Starting build of 'samba-server-5-i386' at 2009-10-25 18:29:55
Build complete at 2009-10-25 18:30:26</pre><p>Since there were no updates, <span><strong class="command">systembuilder</strong></span> completed
    successfully in less than two minutes. (Results will vary based on factors
    including network connection speed between the build machine and input 
    repositories, number of packages in the distribution, and build 
    machine hardware configuration.) Only if something had changed would
    <span><strong class="command">systembuilder</strong></span> have rerun the repository updates and 
    provided more detail about this build.</p><p>Unless you change the log level or the contents of the distribution, 
    <span><strong class="command">systembuilder</strong></span> will append the minimal output above to 
    the log file.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png" /></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>SystemBuilder's default behavior is to append all build output to the
        <code class="filename">systembuilder.log</code> file in the <code class="filename">/var/log</code> directory. To redirect the
        output for a particular build, use the <span><strong class="command">systembuilder</strong></span>
        command</p><p><strong class="userinput"><code># systembuilder --log-file /var/log/$MYLOGFILE
        samba-server.distribution</code></strong></p><p>where <code class="varname">$MYLOGFILE</code> is the new name of the log
        file.</p></td></tr></table></div><p>If SystemBuilder finds updated packages, it will refresh the 
    <a href="#distribution-repository">distribution repository</a> to contain just the current set
    of packages. Specifically, when SystemBuilder determines that packages have
    changed, it calculates the list of packages needed to satisfy distribution 
    requirements, and then adds and removes packages as necessary to bring the 
    distribution repository into comformance with the list. This behavior 
    allows the <a href="#yum-sync-plugin">YUM Sync Plugin</a> to rely on packages in the 
    distribution repository as a master list of packages to be installed on 
    client machines.</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="images/important.png" /></td><th align="left">Important</th></tr><tr><td align="left" valign="top"><p>If the published download location is the same,
        <span><strong class="command">systembuilder</strong></span> updates the distribution, adding new files and
        replacing old ones.</p></td></tr></table></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id2785592"></a>Modifying the distribution definition</h3></div></div></div><p>If you change the distribution definition, or other build input 
    such as configuration files and scripts, then you need to rerun 
    <span><strong class="command">systembuilder</strong></span>. You may redefine
    your distribution in a plethora of ways. Some of the more common options
    could include selecting different repositories; including or excluding
    groups, packages or custom files (configuration files, scripts or
    triggers); or defining a new destination for the published
    distribution.</p><p>If you change the <span class="emphasis"><em>main/name</em></span>,
    <span class="emphasis"><em>main/version</em></span> or <span class="emphasis"><em>main/arch</em></span> child
    elements, then you are creating a new distribution with a new
    <code class="varname">$ID</code> and <a href="#download-location">download location</a>
    matching the new parameters. To avoid confusion between the different
    distributions, save the new distribution definition with a new name.</p></div><p>To try out distribution updates for the samba-server example, you can 
  make two modifications: remove a group, and modify a configuration file.</p><p>First, let's say you have determined you don't need packages from
  the admin-tools group on this system. You can remove them by removing the 
  corresponding <span class="emphasis"><em>/packages/group</em></span> element. Modify the
  <span class="emphasis"><em>packages</em></span> element to look as follows:</p><div class="informalexample"><pre class="programlisting">
&lt;packages&gt;
  &lt;group&gt;core&lt;/group&gt;
  &lt;group&gt;base&lt;/group&gt;
  &lt;group&gt;base-x&lt;/group&gt;
  &lt;group&gt;gnome-desktop&lt;/group&gt;
  &lt;group&gt;smb-server&lt;/group&gt;
&lt;/packages&gt;  </pre></div><p>Save the <code class="filename">samba-server.distribution</code> file.</p><p>Next, presuming you would like to change the name of the workgroup for 
  your samba server, modify the content of the smb.conf file as follows:</p><div class="informalexample"><pre class="programlisting">
[global]
  workgroup = MYCOMPANY     # was WORKGROUP
  netbios name = SAMBA
  security = share

[public]
  comment = Public
  path = /public
  read only = no
  guest only = yes
    </pre></div><p>Save the smb.conf file</p><p>Now run the command 
  <span><strong class="command">systembuilder samba-server.distribution</strong></span>. You should see 
  that a new configuration package is generated, and that the distribution
  is updated.</p><p>In the next section you will see how these changes are applied to
  previously installed client systems.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="updating-a-client-machine"></a>3.7. Updating a Client Machine</h2></div></div></div><p>If there are changes to the distribution, you will
  need to update installed client machines using the <a href="#yum-sync-plugin">YUM Sync Plugin</a>. For this example build, log on to the client machine 
  as the root user and execute the following commands:</p><div class="informalexample"><pre class="programlisting">
# yum clean metadata
# yum sync
  </pre></div><p>The first command, <strong class="userinput"><code>yum clean metadata</code></strong>, ensures that YUM is using current repository information. For improved performance, YUM caches repository metadata as a matter of course, with a default cache expiration period of 1.5 hours. While you are building and testing a new distribution, you will want to override this behavior by forcing YUM to clean the metadata cache prior to each execution of the <span><strong class="command">yum sync</strong></span> command. See the <span class="emphasis"><em>metadata_expire</em></span> option in <span><strong class="command">man yum.conf</strong></span>, as well as <span><strong class="command">man yum</strong></span> for more information on YUM's caching and cleaning options.</p><p>The second command, <strong class="userinput"><code>yum sync</code></strong>, will update all packages on the client machine from the distribution
  repository, including the system-specific <a href="#configuration-package">configuration package</a>
  created during the build process. The <span class="emphasis"><em>sync</em></span> command is provided by the  
  YUM Sync Plugin, which is included in the configuration package by default.</p><p>To see what packages changed on the client machine, check the
  <code class="filename">yum.log</code> file in the <code class="filename">/var/log/</code> directory.</p><p>For the samba-server example, you should see that a new version of the samba-server-config package is installed, the prior version of the samba-server-config package is removed, and a number packages from the admin-tools group, including system-config-network and system-config-users, are removed. You can verify that the <code class="filename">smb.conf</code> has been updated by typing <span><strong class="command">cat /etc/samba/smb.conf</strong></span> at the command line and ensuring the workgroup is now set to "MYCOMPANY" rather than "WORKGROUP".</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id2785844"></a>3.8. Tying it All Together</h2></div></div></div><p>In summary, there are several steps to creating a successful
  distribution.</p><p>First, you configure the <span class="application">SystemBuilder</span> build machine to accommodate the
  size and number of distributions you will build and store concurrently. The 
  system should be accessible through your local network.
  After configuring the hardware, you can install one of the <span class="application">Linux </span>operating system versions on which <span class="application">SystemBuilder</span> runs.</p><p>Then you define your distribution in the <code class="filename">samba-server.distribution</code> file using XML tags
  defined in the DDFR. Your definition includes several key pieces of
  information:</p><div class="itemizedlist"><ul type="disc"><li><p>the name of the distribution, its version and architecture;</p></li><li><p>the repositories for the operating system and application packages, including
        base install and update mirror locations;</p></li><li><p>the package groups and packages to include and any packages to 
        exclude; and</p></li><li><p>system configuration files and scripts.</p></li></ul></div><p>Once the distribution definition is complete, you log on as the root user
  and execute the command <strong class="userinput"><code>systembuilder samba-server.distribution</code></strong>
  to build the distribution. Output goes to the screen and the default log file.
  The first build may take some time, since <span class="application">SystemBuilder</span> needs to do everything from 
  scratch:</p><div class="itemizedlist"><ul type="disc"><li>file:///usr/share/doc/HTML/index.html
        <p>validate the <code class="filename">samba-server.distribution</code> file,</p></li><li><p>locate input repositories,</p></li><li><p>create the configuration package,</p></li><li><p>resolve package dependencies,</p></li><li><p>download packages from input repositories,</p></li><li><p>create the distribution repository (and it's metadata),</p></li><li><p>create network installation images, and</p></li><li><p>copy, or <span class="emphasis"><em>publish</em></span>, distribution content to a web-accessible location.</p></li></ul></div><p>Deploying client machines requires two steps. First, you 
  create the CD or DVD boot media. And then you install the client machine by
  inserting the disk into the client machine and later verifying that the 
  contents are correct. Alternatively, you can use virt-manager or virt-install
  to deploy new virtual machines based on the distribution.</p><p>Updating your distribution can involve simply checking for mirror 
  repository updates. Or it can involve changing the distribution definition or
  configuration files and scripts. Depending upon the changes it encounters, 
  <span class="application">SystemBuilder</span> will 
  update the distribution as necessary. After updating the
  distribution, you will need to run <strong class="userinput"><code>yum sync</code></strong> on client
  machines to keep them up to date with the current distribution.</p><p>In the Samba CentOS 5 Server example presented here, what you have
  in the end is a distribution for a Samba server on CentOS 5 for the i386
  architecture. Your <code class="filename">smb.conf</code> file provides custom <span class="application">Samba</span> configuration instructions. The
  packages come from the repositories at <a href="http://mirror.centos.org" target="_top">http://mirror.centos.org</a> .</p><p>Now that you have your definition, you can prepare it for use in a
  production environment. The next chapter explains this process.</p></div></div><div class="chapter" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title"><a id="id2786093"></a>Chapter 4. Production Distributions</h2></div></div></div><p>You can harness <span class="application">SystemBuilder</span>'s
  architecture and features to create a production system development
  environment with reusable components for the distribution definition,
  version tracking for that and other configuration files, expedited testing
  procedures and alternate development and production locations. Using <span class="application">SystemBuilder</span> as part of a long-term deployment and
  shop management strategy will enable you to be more efficient and provide an
  distribution development and deployment history that is repeatable and
  predictable.</p><p>In this chapter, you will set up a production process for creating, 
  testing, deploying and updating your Samba server. You will divide your 
  <code class="filename">samba-server.distribution</code> file into reusable components. 
  You'll also choose appropriate download and storage locations. Then you'll log
  those files into the versioning system of your choice. The testing process
  for your distribution definition has several options, which are covered in
  the last section.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id2786141"></a>4.1. Overview</h2></div></div></div><p>The traditional system development life cycle (SDLC) includes several
  stages, such as requirements analysis, system architecture, design and
  implementation, testing, deployment and maintenance. The stages with which
  SystemBuilder is an integral part are implementation, testing, deployment and
  maintenance. Within the SystemBuilder realm, implementation and testing include
  development, with a development build machine and client machines, which can 
  be virtual machines, for testing installation and updates. A
  second phase of testing includes staging, which allows you to
  test the pre-release distribution before releasing it for production.
  This simulated environment includes completing the build and deployment
  processes plus using the distribution as intended for a period of time. The
  final component, production, enables deployment of the distribution to a client
  system. Maintenance is an on-going process that could involve all of these
  stages.</p><p>The advantage of using a repetitive isolated 
  process as described above is that you can develop, test and fine-tune
  your distribution before gradually testing its performance in a simulated 
  environment and, finally, releasing it for real-world use. Within the Linux
  release environment, applications and operating system are updated and upgraded at a variety
  of rates. This process gives you optimum control over what patches, updates,
  enhancements and upgrades you choose to maintain and release in your
  production environment.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id2786178"></a>The Production Process Step-by-Step</h3></div></div></div><p><span class="application">SystemBuilder</span>'s logical network
    diagram, below, and subsequent description of steps covers the process in
    more detail.</p><div class="mediaobject"><img src="systembuilder_logical_network.png" /><div class="caption"><p>SystemBuilder Logical Network</p></div></div><p>To set up production environment with <span class="application">SystemBuilder</span>, you will need a Development 
    system (D); a Version Control system (V); a Staging system (S);
    and a Production system (P). Development and Staging will contain
    identical installations of a <span class="application">SystemBuilder</span> version. The Production system,
    which will serve as your download server, needs to be web-accessible for 
    client machines to be able to access it to retrieve distribution content.
    The Version system needs to have a version control system that supports
    Linux clients.</p><p>In early stages of the process, Steps 1-7, you will work with two 
    versions of your distribution, one for development and one for production. 
    The two versions will be identical with one exception, the <a href="#download-location">download location</a>. This will allow you to test client 
    installation, basic functionality, and updates directly from a development 
    machine prior to moving the distribution to a staging server. In later 
    stages, Steps 5-10, you will work with a single distribution, the production
    distribution, across separate network environments, staging and production. 
    The staging process allows you to test client interactions with simulated 
    network servers and services prior to deployment. The staging environment is
    also where you will test ongoing distribution updates from external package 
    repositories.</p><p>There are several variables worth noting in the diagram. One is that 
    the hostname for Staging and Production systems is identical; this 
    compatibility will aid in Step 9, migrating the production distribution to
    a production download server. The hostnames for Development and Version 
    Control are different from the others. Another point about the diagram is 
    that, as mentioned above, the Production system is in a separate network 
    from the Staging system.</p><div class="variablelist"><dl><dt><span class="term">Step 1: Create Development and Production Definitions</span></dt><dd><p>During this phase you will work with the Development system
            (D). You will create two definitions, in our example, 
            <code class="filename">samba-server-development.distribution</code> and 
            <code class="filename">samba-server-production.distribution</code>. The 
            definitions will be the same with the
            exception of the download location, specified using the 
            <span class="emphasis"><em>publish</em></span> element. See the section in this 
            chapter on <a href="#production-definitions">Production Definitions</a> for more 
            information on creating these files. In addition to creating 
            development and production definitions, you will also create any 
            configuration files necessary for the system to run properly, such 
            as <code class="filename">smb.conf</code>.</p></dd><dt><span class="term">Step 2: Build a Development Distribution</span></dt><dd><p>This step entails building the <span class="emphasis"><em>development</em></span>
            distribution, specifically by running the command 
            <strong class="userinput"><code>systembuilder samba-server-development.distribution
            </code></strong>. (You will build the 
            <span class="emphasis"><em>production</em></span> distribution in Step 6.) 
            </p></dd><dt><span class="term">Step 3: Test on Development Clients</span></dt><dd><p>After building the development distribution, you will install
            it on development clients and test client functionality. During 
            this step you will also test updates to existing 
            client machines. See <a href="#testing-production-updates">Testing Production Updates</a> for
            more information. Steps 1 through 3 are iterative during the 
            development phase, with you incorporating changes to the definition
            and configuration files and testing until you are satisfied with the
            end result.
            </p></dd><dt><span class="term">Step 4: Check-in Definition Files to Version Control</span></dt><dd><p>Once you are satisfied with the results in Step 3, 
            you will set up your Version Control repository (V) and check in 
            definition and configuration files prior to creating the production 
            distribution. From this point forward, if you need to adjust your
            distribution or configuration files in any way, you should return 
            to Step 1, checking out and altering these files using the
            Development system. See <a href="#versioning-definitions">Versioning Definitions</a> for
            information on using a version control system.</p></dd><dt><span class="term">Step 5: Check-out Definition Files to Staging</span></dt><dd><p>Now that development is complete, you are ready to build, 
            deploy and test the production distribution on a staging server.
            Check out the repository with the definition and configuration files
            from Version Control. If you made several revisions to the files,
            check out the version you want to deploy.</p></dd><dt><span class="term">Step 6: Build a Production Distribution</span></dt><dd><p>Using <span class="application">SystemBuilder</span> on
            the Staging system (S), build the production distribution, e.g. 
            <strong class="userinput"><code>systembuilder samba-server-production.distribution
            </code></strong>. In addition you should add a <span><strong class="command">cron</strong></span> 
            instruction on the Staging system to run SystemBuilder on a regular
            basis. This will serve to update the distribution over time as new
            packages are made available in input repositories. See 
            <a href="#creating-a-staging-machine">Creating a Staging Machine</a> for more information.
            </p></dd><dt><span class="term">Step 7: Test on Staging Clients</span></dt><dd><p>Next you will deploy and test the distribution on a Staging
            Client. If the results
            are unsatisfactory, go back to Development (Step 1), check out the
            appropriate files from Version Control, make changes as needed, and 
            continue with steps 2 through 6. Use the iterative
            process in Steps 1-7 until you are satisfied with the results.</p></dd><dt><span class="term">Step 8: Check-in Your Distribution to Version Control</span></dt><dd><p>Once you have successfully built, deployed and tested your
            distribution on the Staging Client, you can check in the 
            distribution <span class="emphasis"><em>itself</em></span> to Version Control. 
            Versioning the distribution allows you to maintain a record of
            who made changes to the distribution and when. It also audits what
            changed in each version.</p></dd><dt><span class="term">Step 9: Migrate Your Distribution to Production for
          Release</span></dt><dd><p>Now you are ready to migrate the distribution that is a result
            of the successful build in Step 6 and that was checked into the 
            Version Control system in Step 8. You will not rerun SystemBuilder
            on the Production system (P). Rather, you will migrate the 
            distribution to Production and release it for download access.
            This practice also ensures a controlled release into Production,
            which improves the lock-down and control process for releasing
            distributions such as DNS or SMTP servers to the production network
            environment.</p></dd><dt><span class="term">Step 10: Deploy and Update Your Distribution on Production Clients</span></dt><dd><p>As in Chapter 2, the "Deploying Clients"
            section, you will create the boot media from the Production system
            and use it to install client machines. In
            turn, the clients will download the system RPMs from the
            Production system. For your production environment, you will most
            likely find it convenient to further automate client installation
            by setting up a PXE boot environment. See 
            <a href="#deploying-production-clients">Deploying Production Clients</a> for more information.</p></dd></dl></div><p>Once you have deployed the distribution to production clients, you may
    discover changes that need to be made. Operating system or applications can have
    updates, incorporating bug fixes or other planned changes. They can have
    upgrades or full version releases with new features. Or you may want to
    add or remove applications or change configuration settings. Depending
    upon the change needed, the process will differ. Part III will discuss the
    differences and methods of implementation.</p></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="production-definitions"></a>4.2. Production Definitions</h2></div></div></div><p>When working with your distribution through the development - staging - 
  production cycle, you will manage two versions of it, a development 
  version and a production version. The development version, which
  specifies the Development server as the <a href="#download-location">download location</a>, 
  is used for modifying and testing changes to the definition itself and to 
  configuration files such as smb.conf. The production version is used in 
  both the Staging and Production environments. It specifies a download location
  using a hostname that is common across Staging and Production network 
  environments.</p><p>To create definitions for both versions, you will first create the development
  definition. Then you will create the production defintion. To keep the two
  documents synchronized, with the exception of the download-location (specified
  using the <span class="emphasis"><em>publish</em></span> element), you will use XML Includes 
  (XInclude) to reuse content from the former within the latter.</p><p>XIncludes are a convenient feature, in general, for reusing content 
  across multiple definitions. Later in this section we will discuss an additional 
  scenario for using XInclude. We will also cover important limitations in 
  SystemBuilder's XInclude support.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id2786629"></a>Create Development and Production Definitions</h3></div></div></div><p>To create a <span class="emphasis"><em>development</em></span> definition for the samba-server example, begin
    with the <code class="filename">samba-server.distribution</code> file you created in
    <a href="#defining-a-distribution">Defining a Distribution</a>. First, rename the definition:</p><div class="informalexample"><pre class="programlisting">
mv samba-server.distribution samba-server-developer.distribution
    </pre></div><p>Then modify the <span class="emphasis"><em>/main/name</em></span> element as follows:</p><div class="informalexample"><pre class="programlisting">
&lt;main&gt;
  &lt;name&gt;samba-server-development&lt;/name&gt;
  ...
&lt;/main&gt;
      </pre></div><p>The next step is to create a <span class="emphasis"><em>production</em></span> definition. You have three objectives when creating this file. The first is to reuse as much content from the development definition as possible.  You will do this using XInclude statements. The second is to change the name of the distribution, which will allow both the development and production distributions to be built on the same physical machine, if desired, without overwriting each other. This objective is accomplished by changing the <span class="emphasis"><em>/main/name</em></span> element. The third is to change the <a href="#download-location">download location</a> for the distribution, specifying a fixed URL that is common across Staging and Production environments.  You will do this by adding a <span class="emphasis"><em>/publish/remote-url</em></span> element. In our example the URL will be <code class="filename">http://download.company.com/distributions</code>. The completed <code class="filename">samba-server-production.distribution</code> will look as follows:</p><div class="informalexample"><pre class="programlisting">
&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;distribution xmlns:xi="http://www.w3.org/2001/XInclude"&gt;

&lt;main&gt;
  &lt;name&gt;samba-server&lt;/name&gt;
  &lt;!-- reuse all elements from /distribution/main except "name" --&gt;
  &lt;xi:include href="samba-server-development.distribution"
   xpointer="xpointer(/distribution/main/*[name()!=&amp;quot;name&amp;quot;])"/&gt; 
&lt;/main&gt;

&lt;!-- reuse all elements from /distribution except "main" --&gt;
&lt;xi:include href="samba-server-development.distribution"
 xpointer="xpointer(/distribution/*[name()!=&amp;quot;main&amp;quot;])"/&gt;

&lt;publish&gt;
  &lt;remote-url&gt;http://download.company.com/distributions/&lt;/remote-url&gt;
&lt;/publish&gt;

&lt;/distribution&gt;
      </pre></div><p>You can see how the file appears after the xincludes have been processed using the <span><strong class="command">xmllint</strong></span> command as follows:</p><div class="informalexample"><pre class="programlisting">
xmllint --xinclude --format samba-server-production.distribution
      </pre></div><p>Once you have created the files, you can ensure they are valid for use with SystemBuilder using the --validate-only command as follows, where $filename is the name of the file to validate:</p><div class="informalexample"><pre class="programlisting">
# systembuilder --validate-only $filename
      </pre></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id2786781"></a>Strategies for Content Reuse with XInclude</h3></div></div></div><p>To ease the organization and reuse of information, the software development community
  commonly uses substitution methods. In the case of SystemBuilder, you can create and
  store content in one location and use XML Inclusions (XInclude) and XPaths 
  to reuse content across distribution definitions and condense large definition
  files into more manageable and readable sections using an object-oriented
  tree. Within that context, some components of a distribution definition are
  prime candidates for substitution and reuse.</p><p>Using XInclude instructions within your definitions has a number of
  advantages. XInclude processing is recursive. You can have multiple layers of 
  XIncluded documents within one collective distribution definition. By using 
  XPointer you can target one portion of a document. From a time management 
  standpoint, you spend time creating static sections once, then reuse them. 
  If your network topology changes, for example, then you have one file to 
  change, not ten, and the inherent risk of inaccuracies or inconsistencies 
  among the definitions and within your network.</p><p>Using XIncludes with SystemBuilder does have one significant limitation, and this has to do with relative path resolution. Specifically, while paths within <span class="emphasis"><em>http</em></span> attributes of <span class="emphasis"><em>include</em></span> elements are resolved relative to the <span class="emphasis"><em>including document's location</em></span>, SystemBuilder resolves all other paths, as noted in <a href="#defining-a-distribution">Defining a Distribution</a>, relative to the <span class="emphasis"><em>location of the definition</em></span>. Because of this limitation, you will need to exercise care when planning the file system structure for your definitions and shared content.</p><p>Within the context of SystemBuilder, a two-part structure on the <span class="application">SystemBuilder</span> build machine will suffice for
  managing the common versus unique definition components. As in the diagram
  below, under the subdirectory <code class="filename">distributions/
  </code>, the <code class="filename">common/</code> branch
  contains reusable components while the other branches each contain files
  unique to a single distribution.</p><div class="mediaobject"><img src="distribution_definition_reuse.png" /><div class="caption"><p>Distribution Definition File Reuse</p></div></div><p>To properly use the XInclude and XPointer structures, the directory
  tree must represent the tiered structure above. In other words, the common
  files to be included must exist at the same tier as any distribution definitions that
  references them.</p><p>In the <code class="filename">distributions/common/</code>
  directory above, there are several reusable files.
  <code class="filename">Repos.xml</code> contains several repository mirror lists and
  base URLs from which to download the Linux operating system based upon brand, architecture
  and whether they are "base" or "updates." The
  <code class="filename">groups-packages.xml</code> file contains common application
  groups and packages that would be included in distributions using any operating system, such
  as "admin" or "editors."</p><p>For the Samba Server, the directory <code class="filename">distributions/samba-server/</code> in the drawing above
  contains the <code class="filename">samba-server.distribution</code> file, the Samba
  server configuration file, a kickstart file and a validation script. The
  distribution definition would XInclude
  components from the repositories, common groups and packages. The same logic holds true for the web and DNS servers.</p><p>To see the differences between one large versus several small files,
  let's take the <code class="filename">samba-server.distribution</code> file you created
  in Part I and modify that to use XInclude and XPointer statements. To do
  that you will create a separate repository file,
  <code class="filename">repos.xml.</code></p><p>First, create your <code class="filename">distributions/</code>
  subdirectory with the two subdirectories <code class="filename">common/</code> and <code class="filename">samba-server/</code> as above. Place your
  <code class="filename">samba-server.distribution</code> and
  <code class="filename">smb.conf</code> files in the latter.</p><p>Next, create the <code class="filename">distributions/common/repos.xml</code>
  using the example below. The separate repository file includes the URLs for
  several operating system brands, architectures and statuses, e.g. "base" and
  "updates."</p><div class="informalexample"><pre class="programlisting">&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;distribution xmlns:xi="http://www.w3.org/2001/XInclude"&gt;

&lt;!-- reposistories for centos --&gt;
&lt;repos-centos&gt;
&lt;!-- See www.centos.org for a list of public mirrors --&gt;
    &lt;repo id="base"&gt;
      &lt;name&gt;CentOS-$releasever - Base&lt;/name&gt;
      &lt;baseurl&gt;http://mirror.centos.org/centos/$releasever/os/
           $basearch/&lt;/baseurl&gt;
      &lt;mirrorlist&gt;http://mirrorlist.centos.org/?release=$releasever&amp;amp;
           arch=$basearch&amp;amp;repo=os&amp;amp;country=us&lt;/mirrorlist&gt;
    &lt;/repo&gt;
    &lt;repo id="updates"&gt;
      &lt;name&gt;CentOS-$releasever - Updates&lt;/name&gt;
      &lt;baseurl&gt;http://mirror.centos.org/centos/$releasever/updates/
           $basearch/&lt;/baseurl&gt;
      &lt;mirrorlist&gt;http://mirrorlist.centos.org/?release=$releasever&amp;amp;
           arch=$basearch&amp;amp;repo=updates&amp;amp;country=us&lt;/mirrorlist&gt;
    &lt;/repo&gt;

&lt;/repos-centos&gt;

&lt;/distribution&gt;</pre></div><p>The final step is to modify the
  <code class="filename">samba-server.distribution</code> file, removing the
  <span class="emphasis"><em>repos</em></span> details and using XInclude and XPointer to reuse
  common content. You may want to rename the distribution definition or include it in 
  a version control system.</p><div class="informalexample"><pre class="programlisting">&lt;repos&gt;

    &lt;!-- use global repos for CentOS --&gt;
    &lt;xi:include href="../common/repos.xml" 
                xpointer="xpointer(/distributions/repos-centos/*)" /&gt;

  &lt;/repos&gt;</pre></div><p>To build the distribution definition,
  you will also have to change the path to the <code class="filename">smb.conf</code>
  file in <span class="emphasis"><em>config/file</em></span>.</p><p>The result is an object-oriented distribution definition that will
  reduce your maintenance overhead.</p></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="versioning-definitions"></a>4.3. Versioning Definitions</h2></div></div></div><p>To track and audit any changes to the <span class="application">SystemBuilder</span> files that are critical to the
  definition, configuration and scripts of a system, use a revision
  control system, such as <span class="application">Subversion</span>, <span class="application">Git</span> or <span class="application">Mercurial</span>. The Red Hat-based Linux operating system' that
  SystemBuilder works with by default (<span class="application">RHEL</span> and <span class="application">CentOS</span>) have the revision control system
  <span class="application">Subversion</span>
  (<span><strong class="command">svn</strong></span>) available by default.</p><p>While everything could be revision controlled, there are some key
  non-image files that should be. Within the <span class="application">SystemBuilder</span> infrastructure and distribution
  building process, candidates for revision control include configuration files,
  distribution definitions and scripts, i.e. files that contain critical
  textual information that may change over time or are commonly used to define
  aspects of multiple distributions, such as common repositories or network
  configuration.</p><div class="itemizedlist"><ul type="disc"><li><p>distribution definitions,</p></li><li><p><code class="filename">systembuilder.conf</code>,</p></li><li><p>system configuration files,</p></li><li><p>system configuration scripts, and</p></li><li><p>distribution definition XInclude files.</p></li></ul></div><p>If you decide to not use a revision control system, you could rename
  the distribution definition or other key
  files every time you make a change to help you "version" your distribution.
  You can also enter comments in the files. Keep in mind that changing the name
  of distribution definition does not mean <span class="application">
  SystemBuilder</span> will build a new distribution.
  As long as the <code class="varname">$ID</code> remains the same, the
  distribution remains the same.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="creating-a-staging-machine"></a>4.4. Creating a Staging Machine</h2></div></div></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="deploying-production-clients"></a>4.5. Deploying Production Clients</h2></div></div></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="testing-production-updates"></a>4.6. Testing Production Updates</h2></div></div></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id2787294"></a>4.7. Versioning Distributions</h2></div></div></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id2787301"></a>4.8. Creating a Download Server</h2></div></div></div></div></div><div class="chapter" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title"><a id="id2787308"></a>Chapter 5. Doing More with SystemBuilder</h2></div></div></div><p>Now that you have created your basic
  <code class="filename">samba-server.distribution</code>, you can customize your
  system through additional elements in the distribution definition. When
  selecting packages, you may want certain events to occur depending upon what
  package version is installed or deinstalled. Scripts that run automatically
  or are triggered upon certain installation or deinstallation events give you
  more power over the sequence of events and combination of packages. You can
  also automate system installation by including a kickstart file. SystemBuilder
  also accomodates your preferences for media and kernel boot arguments. If your
  company's legal department or custom software development department
  requires certain content, you can include those components, as well.</p><p>Updating your distribution is easy with SystemBuilder, but you need to
  understand whether the client machine or just the distribution repository or
  both will include any updates. The next chapter addresses that critical issue.
  </p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id2787343"></a>5.1. Enhancing Your Samba Server</h2></div></div></div><p>In this part, you will learn how to update your distribution 
  with some common server administration components using two different methods.
  These  updates require changes to the <span class="emphasis"><em>config</em></span> and
  <span class="emphasis"><em>packages</em></span> elements already in place in your
  <code class="filename">samba-server.distribution</code> file.</p><p>Following the illustrations in this section, you can conditionally
  configure applications in your distribution, automate installation, create
  various install images, add business support required by the legal and
  software development departments and secure your system. All of these
  options utilize top-level elements that you include in your system
  distribution definition, <code class="filename">samba-server.distribution</code>.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="automating-installations"></a>5.2. Automating Installations</h2></div></div></div><p>SystemBuilder can save you time and labor by helping you automate the
  client boot-up and kickstart process.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id2787398"></a>Kickstarting Client Systems</h3></div></div></div><p>Kickstart installations automate the install process of a RedHat operating system
    and make the installations reproducible. You may want to use this method
    if you have large-scale installations, complex storage requirements,
    multiple network interfaces, secure systems or site-specific strategies.
    Within the SystemBuilder process, the kickstart file automates the installation and
    manages several functions during the install: selection of language,
    network configuration, distribution source, keyboard, filesystem, mouse,
    timezone, root password and package handling.</p><p>Instead of managing multiple kickstart files, SystemBuilder lets you make it
    part of the distribution definition. By revision controlling the SystemBuilder files
    (see Part 2), the kickstart process can be controlled, too.</p><p>Use the <span class="emphasis"><em>kickstart</em></span> element in the
    <code class="filename">samba-server.distribution</code> file to identify one kickstart
    file, as in the example below. Substitute your own kickstart filename for
    <code class="filename">ks.cfg</code>.</p><div class="informalexample"><pre class="programlisting">&lt;kickstart&gt;ks.cfg&lt;/kickstart&gt;</pre></div><p>See the DDFR for the <span class="emphasis"><em>kickstart</em></span> element 
    syntax.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id2787461"></a>Modifying boot.iso and diskboot.img network installation images</h3></div></div></div><p>To add custom kernel boot arguments to the <code class="filename">/isolinux/isolinux.cfg</code> file of the
    <code class="filename">boot.iso</code> image, use the <span class="emphasis"><em>bootiso</em></span>
    element in your distribution definition. Substitute your appropriate IP
    addresses.</p><div class="informalexample"><pre class="programlisting">&lt;bootiso&gt;
  &lt;boot-args use-defaults="false"&gt;
  keymap=us lang=en_US ip=192.168.0.222
  netmask=255.255.255.0 gateway=192.168.0.2 dns=192.168.0.7
  &lt;/boot-args&gt;
  &lt;/bootiso&gt;</pre></div><p>To create a USB diskboot <code class="filename">IMG</code>
    file and possibly add custom boot arguments to the
    <code class="filename">/syslinux.cfg</code> file, use the
    <span class="emphasis"><em>diskboot-image</em></span> element in your
    <code class="filename">samba-server.distribution</code> file. The example below disables
    the default boot arguments "%{ks}," "%{method}," and "nousbstorage."</p><div class="informalexample"><pre class="programlisting">&lt;diskboot-image enabled="true"&gt;
  &lt;!-- no args will be appended to syslinux.cfg --&gt;
  &lt;boot-args use-defaults="false" /&gt;
  &lt;/diskboot-image&gt;</pre></div><p>See the DDFR for the complete syntaxes of the 
    <span class="emphasis"><em>bootiso</em></span> and <span class="emphasis"><em>diskboot</em></span> elements.
    </p></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="using-scripts-and-triggers"></a>5.3. Using Scripts and Triggers</h2></div></div></div><p>Scripts and triggers enable you to control your client's environment
  to a great degree. To include these in your distribution, use the
  <span class="emphasis"><em>config</em></span> element in your
  <code class="filename">samba-server.distribution</code> file.</p><p>The program that installs RPMs on the client machine
  actually runs scripts depending upon one of several possible situations. Include
  these scripts using <span class="emphasis"><em>config/scripts</em></span> in your
  distribution definition. Commonly referred to by their installation script
  markers in an RPM spec file, the scripts execute prior to or following
  installation or uninstallation. See Section 9.4.4 "Defining installation
  scripts," in the Fedora Project's documentation, <a href="http://docs.fedoraproject.org/drafts/rpm-guide-en/" target="_top">RPM Guide</a>
  by Eric Foster-Johnson. See also 
  <a href="http://fedoraproject.org/wiki/Packaging/ScriptletSnippets" target="_top">
  Fedora Packaging ScriptletSnippets wiki page</a> and the 
  <a href="http://www.rpm.org/max-rpm-snapshot/" target="_top">Maximum RPM</a>book.
  </p><p>You can also use trigger events as in the RPM spec file. The
  installation program will run these scripts based upon various combinations
  of installing, upgrading or removing the target package or your package. See
  Section 10.2 "Setting Triggers," in the Fedora Project's documentation,
  <a href="http://docs.fedoraproject.org/drafts/rpm-guide-en/" target="_top">RPM
  Guide</a> by Eric Foster-Johnson for a discussion of the trigger options
  and their implications. To activate these trigger options using SystemBuilder,
  include them with the <span class="emphasis"><em>config/trigger</em></span> element of
  your distribution definition.</p><p>In the example below, the <span class="emphasis"><em>/script</em></span> element directs
  the installation program to execute the <code class="filename">smb.script</code> file
  after installing the RPM.</p><div class="informalexample"><pre class="programlisting">&lt;!-- start samba daemon at init levels 3 and 5  --&gt;
&lt;script type="post" content="filename"&gt;
scripts/smb.script
&lt;/script&gt;</pre></div><p>For the installation to run properly, you will need to create the
  <code class="filename">smb.script</code> file under a <code class="filename">scripts</code> directory and include the contents
  below. </p><div class="informalexample"><pre class="programlisting">/sbin/service smb start
/sbin/chkconfig --level 35 smb on</pre></div><p>In the <span class="emphasis"><em>/trigger </em></span>element example, below, includes
  an <code class="filename">smb.sh</code> script file to run when the program installs
  the samba package.</p><div class="informalexample"><pre class="programlisting">&lt;!-- run shell script to check if samba-related services are present --&gt;
&lt;trigger package="samba" type="triggerin" content="filename"&gt;
scripts/smb.sh
&lt;/trigger&gt;</pre></div><p>You will need to create a sample <code class="filename">smb.sh</code> file and
  store it in the relative location. The contents are below.</p><div class="informalexample"><pre class="programlisting">#!/bin/sh
if test -s /etc/samba/smb.conf; then
 cp smb.conf /etc/samba
# could also run an /etc/init.d script
else
 mkdir /etc/samba
 cp smb.conf /etc/samba
fi </pre></div><p>Include both of these examples in the <span class="emphasis"><em>config</em></span>
  element of your <code class="filename">samba-server.distribution</code>. </p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id2787757"></a>5.4. Verifying Package Integrity</h2></div></div></div><p>Verifying package integrity using GPG is a secure way of ensuring that
  you have downloaded the correct set of data; if the key matches the
  information in the data set, then the set is correct.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id2787769"></a>Checking the packages</h3></div></div></div><p>For a repository that you use in the <span class="emphasis"><em>repos/repo</em></span>
    element, you can indicate whether GPG checking is enabled by setting
    <span class="emphasis"><em>/repo/gpgcheck</em></span> to TRUE. You must also include at
    least one GPG key file using <span class="emphasis"><em>/repo/gpgkey</em></span>.</p><p>In your <code class="filename">samba-server.distribution</code> file under your
    <span class="emphasis"><em>repos/repo</em></span> listing for "base" repository, you can add
    the following code to use the public key provided for CentOS 5.</p><div class="informalexample"><pre class="programlisting">&lt;gpgcheck&gt;yes&lt;/gpgcheck&gt;
&lt;gpgkey&gt;http://mirror.centos.org/centos/RPM-GPG-KEY-CentOS-5&lt;gpgkey&gt;</pre></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id2787818"></a>Signing your packages</h3></div></div></div><p>To authenticate your distribution RPMS, you can also sign them and
    provide a password in your <code class="filename">samba-server.distribution</code>
    file. Use the <span class="emphasis"><em>gpgsign/secret-key</em></span> for exported,
    armored GPG secret key that signs your distribution and
    <span class="emphasis"><em>gpgsign/public-key</em></span> to enter the exported, armored GPG
    public key file that matches the <span class="emphasis"><em>/secret-key</em></span>. You may
    enter a password in plain text form using the
    <span class="emphasis"><em>/passphrase</em></span> element, which is necessary if you want
    to run SystemBuilder without user interaction. If there is no passphrase, then SystemBuilder
    will prompt you for the passphrase during the build process.</p><p>The example below uses the keys without the passphrase, thus
    requiring you to be present during the process to enter the
    passphrase.</p><div class="informalexample"><pre class="programlisting">&lt;gpgsign&gt;
     &lt;public-key&gt;
     GPG/GPG-public.key
     &lt;/public-key&gt;
     &lt;secret-key&gt;
     GPG/GPG-secret.key
     &lt;/secret-key&gt;
&lt;/gpgsign&gt;</pre></div><p>Since all <span class="application">RedHat</span>
    repositories have a GPG key for the distributions, you may want to sign
    and key any new distribution repository as standard practice.</p></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id2787887"></a>5.5. Creating CD/DVD Images</h2></div></div></div><p>By default SystemBuilder creates <code class="filename">boot.iso</code> and
  <code class="filename">diskboot.img</code> files for CD media. All images come with
  default sets of kernel boot arguments. But SystemBuilder allows you to do more. You
  can create multiple sets of release images for CD or DVD or create a USB
  key-ready image. You can also specify custom kernel boot arguments for each
  file type. Modify your <code class="filename">samba-server.distribution</code> file to
  include what image customization options you want.</p><p>To specify custom <code class="filename">ISO</code> file
  sizes and media, use the <span class="emphasis"><em>iso</em></span> element and specify which
  sets you want. You can also add custom kernel boot arguments to the <code class="filename">ISO</code> files, as well. The default values are
  "%{ks}" and "method=cdrom." The example below creates several image
  types.</p><div class="informalexample"><pre class="programlisting">&lt;iso&gt;
&lt;set&gt;DVD&lt;/set&gt; &lt;!-- 4700000000 bytes/disc --&gt;
&lt;set&gt;400000000&lt;/set&gt; &lt;!-- 400000000 bytes/disc --&gt;
&lt;set&gt;640 mb&lt;/set&gt; &lt;!-- 640000000 bytes/disc --&gt;
&lt;set&gt;640 mib&lt;/set&gt; &lt;!-- 671088640 bytes/disc --&gt;
&lt;/iso&gt;</pre></div><p>See the DDFR for the complete syntaxes of <span class="emphasis"><em>iso</em></span>,
  <span class="emphasis"><em>bootiso</em></span> and <span class="emphasis"><em>diskboot</em></span> elements.
  </p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id2787972"></a>5.6. Renaming a Distribution</h2></div></div></div><p>Renaming a distribution brings up several considerations including
  folder cleanup and existing client migration.</p></div></div><div class="chapter" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title"><a id="id2787984"></a>Chapter 6. Appendix A</h2></div></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id2787990"></a>6.1. Example SystemBuilder Output</h2></div></div></div><p>Following is an example of SystemBuilder output for a successful
  first build.</p><div class="informalexample"><pre class="programlisting">
Reading '/~/samba-server.distribution'
Starting build of 'samba-server-5-i386' at 2010-02-09 09:10:54
autoclean
repos
 * downloading repodata - 'base'
   - comps.xml               [=========================]     942 kB (00:06)
   - filelists.sqlite.bz2    [=========================]     3.4 MB (00:10)
   - other.sqlite.bz2        [=========================]     8.3 MB (00:14)
   - primary.sqlite.bz2      [=========================]     1.7 MB (00:03)
   - repomd.xml              [=========================]     2.1 kB (00:00)
 * downloading repodata - 'updates'
   - filelists.sqlite.bz2    [=========================]     2.4 MB (00:19)
   - other.sqlite.bz2        [=========================]     8.1 MB (00:26)
   - primary.sqlite.bz2      [=========================]     474 kB (00:02)
   - repomd.xml              [=========================]     2.0 kB (00:00)
 * verifying repodata file checksums
 * reading available packages
   - base
   - updates
base-info
 * reading buildstamp file from base repository
config
 * downloading files
   - smb.conf                [=========================]     0.0  B (00:00)
 * building samba-server-config-5-1.noarch.rpm
rpmbuild-repo
 * copying packages
 * running createrepo
packages
depsolve
 * verifying repodata file checksums
 * reading available packages
   - base
   - updates
base-info
 * reading buildstamp file from base repository
config
 * downloading files
   - smb.conf                [=========================]     0.0  B (00:00)
 * building samba-server-config-5-1.noarch.rpm
rpmbuild-repo
 * copying packages
 * running createrepo
packages
depsolve
 * reading package metadata                                         (00:06)
 * checking for package changes                                     (00:01)
 * resolving package dependencies
   - loop 1 (346 packages)   [=========================]    346/346 (00:08)
   - loop 2 (371 packages)   [=========================]    371/371 (00:05)
   - loop 3 (83 packages)    [=========================]      83/83 (00:01)
   - loop 4 (16 packages)    [=========================]      16/16 (00:00)
   - loop 5 (5 packages)     [=========================]        5/5 (00:00)
   - loop 6 (1 package)      [=========================]        1/1 (00:05)
   - loop 7 (2 packages)     [=========================]        2/2 (00:00)
 * pkglist closure achieved in 819 packages
 * writing pkglist
download
 * downloading packages - 'base'
   - Deployment_Guide-en-US- [=========================]     3.6 MB (00:43)
   - GConf2-2.14.0-9.el5.i38 [=========================]     1.5 MB (00:18)
   - MAKEDEV-3.23-1.2.i386.r [=========================]     138 kB (00:02)
   ... [output abbreviated for readability]
   - zenity-2.16.0-2.el5.i38 [=========================]     1.2 MB (00:00)
   - zip-2.31-2.el5.i386.rpm [=========================]     130 kB (00:00)
   - zlib-1.2.3-3.i386.rpm   [=========================]      51 kB (00:00)
 * downloading packages - 'updates'
   - PyXML-0.8.4-4.el5_4.2.i [=========================]     1.1 MB (00:00)
   - acpid-1.0.4-9.el5_4.2.i [=========================]      24 kB (00:00)
   - autofs-5.0.1-0.rc2.131. [=========================]     904 kB (00:00)
   ... [output abbreviated for readability]
   - xterm-215-8.el5_4.1.i38 [=========================]     414 kB (00:00)
   - xulrunner-1.9.0.16-2.el [=========================]      10 MB (00:00)
   - yum-fastestmirror-1.1.1 [=========================]      19 kB (00:00)
 * downloading packages - 'rpmbuild-repo'
   - samba-server-config-5-1 [=========================]     2.8 kB (00:00)
gpgcheck
createrepo
 * downloading files
 * running createrepo                                               (01:04)
isolinux
 * downloading files
   - boot.msg                [=========================]     292  B (00:00)
   - general.msg             [=========================]     919  B (00:00)
   - initrd.img              [=========================]     6.9 MB (00:00)
   - isolinux.bin            [=========================]      11 kB (00:00)
   - isolinux.cfg            [=========================]     366  B (00:00)
   - memtest                 [=========================]      95 kB (00:00)
   - options.msg             [=========================]     817  B (00:00)
   - param.msg               [=========================]     517  B (00:00)
   - rescue.msg              [=========================]     490  B (00:00)
   - splash.lss              [=========================]      64 kB (00:00)
   - vmlinuz                 [=========================]     1.9 MB (00:00)
discinfo
buildstamp
stage2-images
 * downloading files
   - minstg2.img             [=========================]      41 MB (00:01)
   - stage2.img              [=========================]     112 MB (00:03)
initrd-image
 * downloading files
   - initrd.img              [=========================]     6.9 MB (00:00)
 * modifying initrd.img
xen-images
 * downloading files
   - initrd.img              [=========================]     6.9 MB (00:00)
   - vmlinuz                 [=========================]     2.2 MB (00:00)
 * downloading files
   - initrd.img              [=========================]     6.9 MB (00:00)
 * modifying initrd.img
product-image
 * modifying product.img
bootiso
   - isolinux.cfg            [=========================]     366  B (00:00)
diskboot-image
 * modifying diskboot.img
pxeboot-images
 * downloading files
   - initrd.img              [=========================]     6.9 MB (00:00)
   - vmlinuz                 [=========================]     1.9 MB (00:00)
treeinfo
compose
 * linking files
 * creating manifest file
publish
 * publishing to '/var/www/html/distributions/samba-server-5-i386' 
Build complete at 2010-02-09 09:18:58
    </pre></div></div></div></div></body></html>
