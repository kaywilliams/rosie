<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE section PUBLIC "-//OASIS//DTD DocBook XML V4.4//EN"
"http://www.oasis-open.org/docbook/xml/4.4/docbookx.dtd">
<section>
  <title>Updating a System</title>

  <para>SystemStudio makes it easy to keep your system distribution up to date over 
  time by simply rerunning the <command>systemstudio</command> command. 
  When SystemStudio runs, it looks for changes in build input, or in the 
  system definition, and makes adjustments to the published
  system distribution as necessary.</para>

  <section>
    <title>Running <command>systemstudio</command> to check for repository
    updates</title>

    <para>To include updated packages from the repositories, execute
    <command>systemstudio</command> with the
    <filename>samba-server.definition</filename> file. <application
    class="software"> Rerunning <command>systemstudio</command> with the same
    <filename class="extension">.definition</filename> file will dramatically
    reduce the build time, assuming there are no changes to the file's
    contents. SystemStudio</application> uses a cache of the packages and verifies the
    cache contents against the metadata for the repository and the groups. The
    screen output below shows the results of a build with no changes to the
    <filename>samba-server.definition</filename> file and no updates to the
    repositories.</para>

    <para><screen>Reading '/home/systemstudio/samba-server.definition'
Starting build of 'samba-server-5-i386' at 2009-10-25 18:29:55
Build complete at 2009-10-25 18:30:26</screen></para>

    <para>Since there were no updates, <command>systemstudio</command> completed
    successfully in less than two minutes. (Results will vary based on factors
    including network connection speed between the build machine and input 
    repositories, number of packages in the system distribution, and build 
    machine hardware configuration.) Only if something had changed would
    <command>systemstudio</command> have rerun the repository updates and 
    provided more detail about this build.</para>

    <para>Unless you change the log level or the contents of the system distribution, 
    <command>systemstudio</command> will append the minimal output above to 
    the log file.</para>

    <para><note>
        <para>SystemStudio's default behavior is to append all build output to the
        <filename>systemstudio.log</filename> file in the <filename
        class="directory">/var/log</filename> directory. To redirect the
        output for a particular build, use the <command>systemstudio</command>
        command</para>

        <para><userinput># systemstudio --log-file /var/log/$MYLOGFILE
        samba-server.definition</userinput></para>

        <para>where <varname>$MYLOGFILE</varname> is the new name of the log
        file.</para>
      </note></para>

    <para>If SystemStudio finds updated packages, it will refresh the 
    <xref linkend="system-repository"/> to contain just the current set
    of packages. Specifically, when SystemStudio determines that packages have
    changed, it calculates the list of packages needed to satisfy system 
    requirements, and then adds and removes packages as necessary to bring the 
    system repository into comformance with the list. This behavior 
    allows the <xref linkend="yum-sync-plugin" /> to rely on packages in the 
    system repository as a master list of packages to be installed on 
    client machines.</para>

    <para><important>
        <para>If the published download location is the same,
        <command>systemstudio</command> updates the system distribution, adding new files and
        replacing old ones.</para>
      </important></para>
  </section>

  <section>
    <title>Modifying the system distribution definition</title>

    <para>If you change the system distribution definition, or other build input 
    such as configuration files and scripts, then you need to rerun 
    <command>systemstudio</command>. You may redefine
    your system distribution in a plethora of ways. Some of the more common options
    could include selecting different repositories; including or excluding
    groups, packages or custom files (configuration files, scripts or
    triggers); or defining a new destination for the published
    system distribution.</para>

    <para>If you change the <emphasis>main/name</emphasis>,
    <emphasis>main/version</emphasis> or <emphasis>main/arch</emphasis> child
    elements, then you are creating a new system distribution with a new
    <varname>$ID</varname> and <xref linkend="download-location"/>
    matching the new parameters. To avoid confusion between the different
    system distributions, save the new system definition with a new name.</para>
  </section>

  <para>To try out system updates for the samba-server example, you can 
  make two modifications: remove a group, and modify a configuration file.</para>

  <para>First, let's say you have determined you don't need packages from
  the admin-tools group on this system. You can remove them by removing the 
  corresponding <emphasis>/packages/group</emphasis> element. Modify the
  <emphasis>packages</emphasis> element to look as follows:</para>

    <para><informalexample>
      <programlisting>
&lt;packages&gt;
  &lt;group&gt;core&lt;/group&gt;
  &lt;group&gt;base&lt;/group&gt;
  &lt;group&gt;base-x&lt;/group&gt;
  &lt;group&gt;gnome-desktop&lt;/group&gt;
  &lt;group&gt;smb-server&lt;/group&gt;
&lt;/packages&gt;  </programlisting>
    </informalexample></para>   

  <para>Save the <filename>samba-server.definition</filename> file.</para>

  <para>Next, presuming you would like to change the name of the workgroup for 
  your samba server, modify the content of the smb.conf file as follows:</para>

  <para><informalexample>
   <programlisting>
[global]
  workgroup = MYCOMPANY     # was WORKGROUP
  netbios name = SAMBA
  security = share

[public]
  comment = Public
  path = /public
  read only = no
  guest only = yes
    </programlisting>
  </informalexample></para>

  <para>Save the smb.conf file</para>

  <para>Now run the command 
  <command>systemstudio samba-server.definition</command>. You should see 
  that a new configuration package is generated, and that the system distribution
  is updated.</para>

  <para>In the next section you will see how these changes are applied to
  previously installed client systems.</para>

</section>
