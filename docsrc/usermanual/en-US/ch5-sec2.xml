<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE chapter PUBLIC "-//OASIS//DTD DocBook XML V4.4//EN"
"http://www.oasis-open.org/docbook/xml/4.4/docbookx.dtd">
<section id="testing-system-updates" >
  <title>Testing System Updates</title>

  <para>
  Deploy enables <emphasis>update</emphasis> testing using the
  <emphasis>test-update</emphasis> element. As with
  <emphasis>test-install</emphasis>, testing is most easily accomplished
  using a template.
  </para>

  <informalexample>
  <programlisting>&lt;test-update>
  &lt;macro id='test-update-poweroff'>false&lt;/macro>
  &lt;include href="%{templates-dir}/%{norm-os}/libvirt/deploy.xml" xpath="./*"/>
&lt;/test-update></programlisting>
  </informalexample>

  <para>
  When the <constant>test-update</constant> element shown above is present,
  Deploy performs the following tasks:
  </para>

  <itemizedlist>
  <listitem>
  <para>
  Creates a test-update repository in the test-update folder at 
  <filename>/var/www/html/deploy/systems/test-update</filename>, by default.
  </para>
  </listitem>

  <listitem>
  <para>
  During the first build cycle after the <emphasis>test-update</emphasis>
  element has been added, uses scripts in the
  <filename>deploy.xml</filename> template to create a new machine to use
  as a baseline for future update testing.  In our web-server example, the
  hostname will be <emphasis>web-server-centos-6-x86-64-test-update</emphasis>.
  You can connect to the virtual machine using SSH as follows:
  </para>

  <programlisting>ssh web-server-centos-6-x86-64-test-update</programlisting>

  </listitem>

  <listitem>
  <para>
  During subsequent runs, updates packages on the test machine to conform to
  packages in the system repository.
  </para>
  </listitem>

  <listitem>
  <para>
  Verifies client machine updates, halting process if an error occurs.
  This allows errors to be resolved prior to publishing changes to the system
  repository. See the <xref linkend='troubleshooting-system-repos'/> section
  for help resolving errors.
  </para>
  </listitem>
  </itemizedlist>

  <para>
  To maintain a consistent testing environment, Deploy does not automatically
  delete and reinstall test-update machines. Instead, if an error occurs,
  Deploy will indicate that a machine already exists. Users will have to
  correct the error, or delete the test-update system manually before Deploy
  can continue. 
  </para>

  <para>
  Once development is complete and the system is stable, you may wish to change
  the value of the <varname>test-update-poweroff</varname> macro to
  <constant>true</constant>. This will cause the virtual machine to be powered
  down once testing is complete, freeing up system resources.
  </para>

</section>
