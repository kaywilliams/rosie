<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE chapter PUBLIC "-//OASIS//DTD DocBook XML V4.4//EN"
"http://www.oasis-open.org/docbook/xml/4.4/docbookx.dtd">
<section id="troubleshooting-system-repos" >
  <title>Troubleshooting</title>

  <para>
  As you work with Repo Studio to create deployment templates and
  config-rpms, you will occasionally run into errors. When these occur, Repo
  Studio halts operation and displays error information to the console. It also
  records error messages in the Repo Studio log file, by default
  <filename>/var/log/repostudio.log</filename>.
  </para>

  <para>
  In addition to displaying and logging error messages, Repo Studio provides
  assistance for troubleshooting errors that occur during client-side script
  processing. Client-side scripts include some deployment scripts and
  config-rpm scripts and triggers. 
  </para>

  <section>
  <title>Troubleshooting errors in client-side deployment scripts</title>

  <para>
  When Repo Studio executes a deployment script using SSH, it first copies
  the script to the client machine and then executes it from there. To assist
  with troubleshooting, Repo Studio leaves copied scripts on the client
  machine.  They can be located in the folder at
  <filename>/var/lib/repostudio/deploy</filename>.
  </para>
  
  <para>  
  Each script exists in a separate file, with a filename corresponding to the
  script's @id attribute. By executing the script from command line on the
  client machine, you will be able to reproduce and troubleshoot errors.
  </para>

  <note>
  <para>  
  You can view virtual clients created by the virt-deploy template by typing
  <command>virt-manager</command> at the command line of the Repo Studio
  build machine.
  </para>  
  </note>
  </section>

  <section>
  <title>Troubleshooting errors in config-rpm scripts</title>

  <para>
  In addition, Repo Studio saves copies of config-rpm scripts on client
  machines. These can be located in the
  <filename>/var/lib/repostudio/config</filename> folder, in subfolders by
  RPM ID, e.g. <emphasis>httpd-config</emphasis>. Within the RPM ID subfolder,
  files are named by script type, e.g. <emphasis>post-script</emphasis> and
  <emphasis>postun-script</emphasis>.  Trigger scripts are named by trigger
  type, followed by the name of the trigger, e.g.
  <emphasis>triggerin-drupal-script</emphasis>.
  </para>

  <para>
  Config-rpm script errors will typically be reported within the context of
  either the <emphasis>verify-install</emphasis> or the
  <emphasis>update</emphasis> deployment scripts. From the error messages, you
  can determine the package in which the script error occurred.
  </para>
  
  <para>
  Errors in trigger scripts can be more difficult to troubleshoot. You will
  need to search folders in the
  <filename>/var/lib/repostudio/config</filename> folder to locate which
  config-rpm, if any, provided the errant trigger script.
  </para>

  <para>
  Once you have located the error-producing script, you can execute it from the
  command line by typing
  <synopsis><emphasis>./script_name</emphasis></synopsis>.  This will allow
  you to reproduce and troubleshoot the error.
  </para>
  </section>
</section>
