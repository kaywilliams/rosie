<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE section PUBLIC "-//OASIS//DTD DocBook XML V4.4//EN"
"http://www.oasis-open.org/docbook/xml/4.4/docbookx.dtd">
<section>
  <title>Building a Distribution</title>

  <para>Now that you have defined your distribution, use the
  <command>systembuilder</command> command to build it. Running 
  <application class="software">SystemBuilder</application> gathers distribution
  content, modifies it as necessary, and publishes a complete
  distribution.</para>

  <para>
  <mediaobject>
    <imageobject>
      <imagedata fileref="build_overview.png" />
    </imageobject>

    <caption><para>SystemBuilder Build Process</para></caption>
  </mediaobject>
  </para>

  <para><application class="software">SystemBuilder</application> uses 
  information from the definition file to gather distribution content including
  network installation images, RPM packages, and configuration files and
  scripts. It processes this information in three primary ways.</para>

  <itemizedlist>
  <listitem><emphasis role="strong">Creates a configuration package.</emphasis> SystemBuilder downloads configuration information and bundles into a configuration package in RPM format. During this step, SystemBuilder creates a <xref linkend="distribution-data-file"/>, if one does not already exist, in the same folder as the distribution definition with a <filename>.dat</filename> file extension. SystemBuilder uses the data file to track and increment the release number of the configuration rpm.</listitem>

  <listitem><emphasis role="strong">Assembles a package repository.</emphasis> Using the distribution definition, SystemBuilder compiles a list of required packages. It then resolves package dependencies, downloads RPMs, and creates a complete, <emphasis>closed</emphasis> package repository. The package repository is used during network installations to client machines. It is also used during client machine updates.</listitem>

  <listitem><emphasis role="strong">Customizes network install images.</emphasis> SystemBuilder downloads network installation images and modifies them to include distribution-specific information. By default, SystemBuilder configures the installer program contained within the images to access distribution content from the <xref linkend="distribution-url"/>. This allows client machines to be installed over the network without needing to provide the URL manually at installation time. SystemBuilder can also be used to completely automate client installations. See <xref linkend="automating-installations"/> for more information.</listitem>
  </itemizedlist>

  <para><application class="software">SystemBuilder</application> stores distribution content in the cache folder, by default <filename type="directory">/var/cache/systembuilder/</filename>. It reuses information from the cache, where possible, on subsequent runs to improve build performance. SystemBuilder sends output both to the screen and to a log file, located by default at <filename>/var/log/systembuilder.log</filename>.</para>

  <section>
    <title>Executing the <command>systembuilder</command> command</title>

    <para>The basic <command>systembuilder</command> command validates the 
    distribution definition file syntax, creates the distribution, and records 
    process results. The default level of screen output includes errors, build
    and module status and file download and creation status. SystemBuilder also
    sends this output to the log file, by default 
    <filename>/var/log/systembuilder.log</filename>. If a critical error
    occurs, SystemBuilder includes detailed error information in the log file.
    To run your build, enter the command below:</para>

    <para><informalexample>
        <programlisting>#systembuilder samba-server.distribution</programlisting>
      </informalexample>The output for an initial run details all the steps
    for downloading packages, checking package dependencies and creating
    images. If there are any errors, <application
    class="software">SystemBuilder</application> notes those and, in many cases,
    halts the process. See Appendix A for an example of a successful first-build
    output.</para>

  </section>
</section>
