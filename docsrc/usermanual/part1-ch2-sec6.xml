<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE section PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
"http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd">
<section>
  <title>Updating Your Distribution</title>

  <para>Maintaining your distribution through updates is the final process step.
  There are two reasons to rerun the <command>systembuilder</command> command and
  update your distribution. You may update the distribution repositories on the
  build server from the mirrors. Or you may redefine your distribution. Depending
  upon what, if anything, you update in the distribution, updates can occur on
  the SystemBuilder build system, the download server and the client system.</para>

  <section>
    <title>Running <command>systembuilder</command> to check for repository
    updates</title>

    <para>To include updated packages from the repositories, execute
    <command>systembuilder</command> with the
    <filename>samber-server.xml</filename> file. <application
    class="software"> Rerunning <command>systembuilder</command> with the same
    <filename class="extension">.distribution</filename> file will dramatically
    reduce the build time, assuming there are no changes to the file's
    contents. SystemBuilder</application> uses a cache of the packages and verifies the
    cache contents against the metadata for the repository and the groups. The
    screen output below shows the results of a build with no changes to the
    <filename>samber-server.xml</filename> file and no updates to the
    repositories.</para>

    <para><screen>Reading '/home/systembuilder/samber-server.xml'
Starting build of 'samba-server-5-i386' at 2008-10-25 18:29:55
Build complete at 2008-10-25 18:30:26</screen></para>

    <para>Since there were no updates, <command>systembuilder</command> completed
    successfully in less than two minutes. (Results will vary depending upon
    your <application class="software">SystemBuilder</application> build system's
    hardware configuration.) Only if something had changed would
    <command>systembuilder</command> have rerun the repository updates and provided
    more detail about this build.</para>

    <para>Unless you change the log level or the contents of the distribution, <command>systembuilder</command> will
    append the minimal output above to the log file.</para>

    <para><note>
        <para>SystemBuilder's default behavior is to append all build output to the
        <filename>systembuilder.log</filename> file in the <filename
        class="directory">/var/log</filename> directory. To redirect the
        output for a particular build, use the <command>systembuilder</command>
        command</para>

        <para><userinput># systembuilder --log-file /var/log/$MYLOGFILE
        samber-server.xml</userinput></para>

        <para>where <varname>$MYLOGFILE</varname> is the new name of the log
        file.</para>
      </note></para>

    <para>If there are updates, then <command>systembuilder</command> will include
    those updated packages in the distribution repository on the build
    system.</para>

    <para><important>
        <para>If the published distribution location is the same,
        <command>systembuilder</command> updates the distribution, adding new files and
        replacing old ones.</para>
      </important></para>
  </section>

  <section>
    <title>Modifying the system definition file</title>

    <para>If you change the distribution definition, then you need to rerun <command>systembuilder</command>. You may redefine
    your distribution in a plethora of ways. Some of the more common options
    could include selecting different repositories; including or excluding
    groups, packages or custom files (configuration files, scripts or
    triggers); or defining a new destination for the published
    distribution.</para>

    <para>If you change the <emphasis>main/name</emphasis>,
    <emphasis>main/version</emphasis> or <emphasis>main/arch</emphasis> child
    elements, then you are creating a new distribution with a new
    <varname>$DISTRIBUTIONID</varname> and published download server location
    matching the new parameters. To avoid confusion between the different
    distributions, save the new definition file with a new name.</para>
  </section>

  <section>
    <title>Updating client systems</title>

    <para>If there are changes to the distribution, you will
    need to update installed client systems using <command>yum</command>
    <option>update</option>. For this example build, log on as the root user
    and execute the <userinput>yum update</userinput> command.</para>

    <para>Using the <command>yum </command><option>update</option> command
    will update all packages on the client system from the download server,
    including the system-specific config and release RPMs created by SystemBuilder.
    For more information about what these RPMs contain and how to customize
    their contents, see the <emphasis>config-rpm</emphasis> and
    <emphasis>release-rpm</emphasis> TLEs in the SDFR.</para>

    <para>To see what changed on the client system, check the
    <filename>yum.log</filename> file in the <filename
    class="directory">/var/log/</filename> directory.</para>
  </section>
</section>
