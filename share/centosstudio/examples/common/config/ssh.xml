<?xml version="1.0" encoding="utf-8"?>
<rpm id='ssh'>
  <requires>openssh</requires>
  <requires>openssh-clients</requires>
  <setup>
  #!/bin/bash
  secret=/root/.ssh/id_rsa
  [[ -f $secret ]] || /usr/bin/ssh-keygen -t rsa -f $secret -N ""
  </setup>
  <files destdir='/root/.ssh/'>/root/.ssh/id_rsa.pub</files>
  <script type='post'>
  # set some convenience variables
  sshdir=/root/.ssh
  pubkey=$sshdir/id_rsa.pub
  authkeys=$sshdir/authorized_keys

  # make sshdir if it doesn't exist
  [[ -d $sshdir ]] || mkdir $sshdir 

  # create authorized_keys file if it doesn't exist
  [[ -f $authkeys ]] || touch $authkeys

  # copy id_rsa into authorized keys if it's not there already
  [[ `cat $authkeys` == *`cat $pubkey`* ]] || cat $pubkey &gt;&gt; $authkeys
    
  # set permissions
  chmod 700 $sshdir
  chmod 600 $authkeys
  </script>
</rpm>
