<?xml version="1.0" encoding="utf-8"?>
<script id='test-triggers' type='test-triggers'>
#!/bin/bash
TRIGGER_INFO=%{trigger-file}

FAIL=0

# create function to handle trigger failures
fail () {
FAIL=1
echo "$1 changed" >&amp;2
}

# get last trigger variables
if [[ -f $TRIGGER_INFO ]]; then
  source $TRIGGER_INFO
fi

# set current trigger variables
curr_triggers='%{triggers}'
curr_release_rpm='%{release_rpm}'
curr_config_rpms='%{config_rpms}'
curr_kickstart='%{kickstart}'
curr_treeinfo='%{treeinfo}'
curr_install_scripts='%{install_scripts}'
curr_post_install_scripts='%{post_install_scripts}'

# test for changes in trigger list
[[ $curr_triggers == $last_triggers ]] || fail 'trigger list'

# test for changes in individual triggers
for trigger in $curr_triggers; do
  curr="echo \$curr_$trigger"
  last="echo \$last_$trigger"
  [[ `eval $curr` == `eval $last` ]] || fail $trigger
done

exit $FAIL
</script>
