<?xml version="1.0" encoding="utf-8"?>
<definition schema-version="1.0" xmlns:xi="http://www.w3.org/2001/XInclude">

<macro id="name">srpmbuild-custom</macro>
<macro id="fullname">Custom RPM Build Virtual Machine</macro>

<xi:include href="srpmbuild.xml"
            xpointer="xpointer(./*[name()!='publish'])"/>

<publish>
<script id='update' type='post' comes-before='check-kernel'>
#!/bin/bash
# the docbook-style-xsl rpm has faulty post scripts; ignore errors on install 
warning=`yum sync -y -q`
if [[ $? != 0 ]] &amp;&amp; [[ ! `echo $warning | grep docbook-style-xsl` ]]; then
  echo 'yum update failed' >&amp;2
  exit 1
fi
</script>

<script id='remove-docbook-style-xsl' type='post' comes-after='copy' comes-before='check-kernel'>
#!/bin/bash
# the docbook-style-xsl rpm has faulty postun scripts; force removal
if rpm -q docbook-style-xsl; then
  rpm -e docbook-style-xsl --noscripts --nodeps 
fi
</script>
<xi:include href="srpmbuild.xml"
            xpointer="xpointer(./publish/*[name()!='script'])"/>
<xi:include href="srpmbuild.xml"
            xpointer="xpointer(./publish/script[@id!='update'])"/>
</publish>
</definition>
