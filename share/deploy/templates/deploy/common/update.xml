<?xml version="1.0" encoding="utf-8"?>
<script id='update' type='post' comes-before="check-kernel, poweroff" verbose='true'>
#!/bin/bash

# run yum sync, checking output for scriptlet failed errors
while read -r line
do
  echo $line
  if [[ $line == *"scriptlet failed"* ]]; then
    failed="$failed `echo $line | sed -n '/^[^(]*(\([^)]*\)).*/s//\1/p'`"
  fi
done &lt; &lt;(yum sync -y)

# if found, remove failed packages and exit with an error
if [[ ${#failed} > 0 ]]; then
  echo "Removing failed package(s): $failed"
  yum erase $failed -q -y --cacheonly --disableplugin sync
  exit 1
fi
</script>
