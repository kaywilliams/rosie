<?xml version="1.0" encoding="utf-8"?>
<script id='virt-delete' type='delete'>
#!/bin/bash
set -e
# remove managedsave image, if domain exists
if [[ `/usr/bin/virsh list --all` = *\ %{hostname}\ * ]]; then 
  /usr/bin/virsh managedsave-remove %{hostname} 
fi

# destroy domain, if active
if [[ `/usr/bin/virsh list` = *\ %{hostname}\ * ]]; then
  /usr/bin/virsh destroy %{hostname}
fi

# undefine domain and delete image, if domain exists
if [[ `/usr/bin/virsh list --all` = *\ %{hostname}\ * ]]; then 
  /usr/bin/virsh undefine %{hostname}
  /usr/bin/virsh vol-delete --pool default %{hostname}.img
fi
</script>
