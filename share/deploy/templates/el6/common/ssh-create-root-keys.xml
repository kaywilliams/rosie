<config-rpm id='ssh-create-root-keys'>
<requires>openssh</requires>
<requires>openssl</requires>

<!-- create ssh keys -->
<prep-script>
#!/bin/sh
set -e
function create_ssh_keys {
<include href="%{templates-dir}/%{norm-os}/common/create-ssh-keys.sh" parse='text'/>
}
create_ssh_keys %{data-dir} %{ssh-host}
</prep-script>

<!-- install ssh keys (created in the prep script) -->
<files destdir="/root/.ssh" mode="600">%{data-dir}/id_rsa</files>
<files destdir="/root/.ssh" mode="644">%{data-dir}/id_rsa.pub</files>

<!-- secure the /root/.ssh folder -->
<script type='post'>
chmod 700 /root/.ssh
</script>
</config-rpm>
