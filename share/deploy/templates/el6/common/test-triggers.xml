<?xml version="1.0" encoding="utf-8"?>
<script id='test-triggers' type='test-triggers'>
#!/bin/bash
TRIGGER_INFO=%{trigger-file}

FAIL=0

# create function to handle trigger failures
fail () {
FAIL=3
echo "$1 changed" >&amp;2
}

# get last trigger variables
if [[ -f $TRIGGER_INFO ]]; then
  source $TRIGGER_INFO
else
  FAIL=1
  echo "missing trigger information" >&amp;2
fi

# set current trigger variables
curr_triggers='%{triggers}'
curr_release_pkg_csum='%{release_pkg_csum}'
curr_custom_pkgs_csum='%{custom_pkgs_csum}'
curr_kickstart_csum='%{kickstart_csum}'
curr_treeinfo_csum='%{treeinfo_csum}'
curr_install_scripts_csum='%{install_scripts_csum}'
curr_post_install_scripts_csum='%{post_install_scripts_csum}'

# test for changes in trigger list
[[ $curr_triggers == $last_triggers ]] || fail 'trigger list'

# test for changes in individual triggers
for trigger in $curr_triggers; do
  curr="echo \$curr_$trigger"
  last="echo \$last_$trigger"
  [[ `eval $curr` == `eval $last` ]] || fail $trigger
done

exit $FAIL
</script>
