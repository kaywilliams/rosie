<?xml version="1.0" encoding="utf-8"?>
<script id='test-exists' type='test-exists'>
#!/usr/bin/python

import libvirt
import os
import sys

from deploy.util import pps
file = pps.path(os.path.dirname(os.path.abspath(__file__)))/ 'libvirt-%{module}'

if file.exists():
  guestname = file.read_text().strip().replace('guestname=', '')
else:
  sys.stderr.write("unable to determine guestname\n")
  sys.exit(1)

connection = libvirt.open('qemu:///system')
try: #vm exists?
  vm = connection.lookupByName(guestname)
except libvirt.libvirtError:
  sys.stderr.write("vm does not exist\n")
  sys.exit(3)
</script>
