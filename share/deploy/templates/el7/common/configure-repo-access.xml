<?xml version="1.0" encoding="utf-8"?>
<script id='configure-repo-access' type='update' 
        comes-before='update-yum-conf'
        hostname='localhost'>
# setup to handle access control syntax change after httpd 2.2
if rpm -q httpd | grep -q httpd-2.2; then
  TEXT="SSLRequireSSL
Order Deny,Allow
Deny from all
Allow from 127.0.0.1 ::1 %{ssh-host}"
else
  TEXT="SSLRequireSSL
Require local %{ssh-host}"
fi

# allow client access to the repository
echo "&lt;directorymatch \"^%{localroot}/\">
$TEXT
&lt;/directorymatch>" > /etc/httpd/conf.d/%{id}-%{module}.conf
if [ -f /usr/bin/systemctl ]; then
  systemctl reload httpd
else
  service httpd restart >/dev/null
fi
</script>
