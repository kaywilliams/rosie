<config-rpm id='ssh-create-root-keys'>

<group>core</group>

<requires>openssh</requires>
<requires>openssl</requires>

<!-- create ssh keys -->
<prep-script>
#!/usr/bin/python

import sys
from deploy.util import pps

lib = pps.path('%{templates-dir}/%{norm-os}/common/ssh_lib.py')
sys.path.insert(0, lib.dirname)

from ssh_lib import *

create_keys('%{data-dir}', 'root@%{id}')
</prep-script>

<!-- install ssh keys (created in the prep script) -->
<files destdir="/root/.ssh" mode="600">%{data-dir}/id_rsa</files>
<files destdir="/root/.ssh" mode="644">%{data-dir}/id_rsa.pub</files>

<!-- secure the /root/.ssh folder -->
<script type='post'>
chmod 700 /root/.ssh
</script>
</config-rpm>
