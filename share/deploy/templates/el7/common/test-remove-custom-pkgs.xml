<?xml version="1.0" encoding="utf-8"?>
<script id='test-remove-custom-pkgs' type='post' verbose='true' 
        comes-before="check-kernel, poweroff"> 
#!/bin/sh

# test custom package removal
for p in %{custom-pkgs}; do
  output=$(yum -y --disableplugin sync remove $p 2>&amp;1)
  if [ $? == 0 ]; then
    continue
  else
    FAIL=true
    while read -r line
    do
      protected=$(echo $line | sed -n \
        's/^Error: Trying to remove "\([^"]*\)", which is protected.*/\1/p')
      if [ -n "$protected" ]; then
        echo "Note: unable to perform a test removal of '$p', which is needed for protected package '$protected'"
        FAIL=false
        break
      fi
    done &lt;&lt;&lt; "$output"
    if [[ $FAIL == true ]]; then exit 1; fi
  fi
done
</script>
