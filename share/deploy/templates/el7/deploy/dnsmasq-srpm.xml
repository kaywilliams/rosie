<?xml version="1.0" encoding="utf-8"?>
<srpm id='dnsmasq'>
<!-- dnsmasq 2.66.13 required by deploy-libvirt-config -->
<script>
set -e
set -x
gitdir=%{script-dir}/%{srpm-id}/git
commondir=$gitdir/centos-git-common
dnsmasqdir=$gitdir/dnsmasq

# download current sources from git.centos.org
mkdir -p $gitdir
cd $gitdir
git clone https://git.centos.org/git/centos-git-common.git >/dev/null
git clone https://git.centos.org/git/rpms/dnsmasq.git >/dev/null
cd $dnsmasqdir
git checkout c7 >/dev/null
$commondir/get_sources.sh -q

# exit if specfile hasn't changed
diff -q SPECS/dnsmasq.spec %{srpm-dir}/dnsmasq.spec &amp;&amp; exit 0 

# copy patch
cp %{templates-dir}/%{norm-os}/deploy/dnsmasq/dnsmasq-2.66-Handle-wrong-interface-for-locally-routed-packets.patch SOURCES/

# update specfile
cd SPECS
patch &lt; %{templates-dir}/%{norm-os}/deploy/dnsmasq/dnsmasq.spec.patch

# create srpm
rpmbuild -bs --define="_topdir $dnsmasqdir" --nodeps dnsmasq.spec

# copy srpm and specfile to srpm-dir
rm -rf %{srpm-dir}/*
cp ../SRPMS/dnsmasq*.src.rpm %{srpm-dir}
cp dnsmasq.spec %{srpm-dir}/dnsmasq.spec
</script>
<!--
<path>
http://www.deployproject.org/products/deploy/sources/dnsmasq-2.66.13-1.el6.src.rpm
</path>
-->
<exclude>dnsmasq-utils</exclude>
</srpm>
