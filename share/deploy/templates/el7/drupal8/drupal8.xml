<?xml version="1.0" encoding="UTF-8"?>
<config-rpm id='drupal8'>

<macro id='drupal-version'>8.1.3</macro>

<macro id='download-dir'>/root/Downloads</macro>
<macro id='drupal-download-dir'>%{download-dir}/drupal8</macro>

<macro id='drupal-web-dir'>/var/www/html/drupal</macro>

<requires>httpd</requires>
<requires>gzip</requires>
<requires>wget</requires>

<!-- TODO extend the script below - see https://www.drupal.org/node/2700999 -->

<script type='post'>
#!/bin/bash
set -e

# download latest version
mkdir -p %{download-dir}
cd %{download-dir}
wget -q https://ftp.drupal.org/files/projects/drupal-%{drupal-version}.tar.gz
tar -zxpf drupal-%{drupal-version}.tar.gz
mv -f drupal-%{drupal-version} %{drupal-download-dir}

# create default settings.php
cd %{drupal-download-dir}/sites/default
cp -p default.settings.php settings.php

# create default files dir
mkdir -p %{drupal-download-dir}/sites/default/files

# copy to webroot
rm -rf %{drupal-web-dir}
cp -ar %{drupal-download-dir} %{drupal-web-dir}

# set file permissions
chown -R apache:apache %{drupal-web-dir}/sites
chcon -R -t httpd_sys_content_rw_t %{drupal-web-dir}/sites
</script>
</config-rpm>
