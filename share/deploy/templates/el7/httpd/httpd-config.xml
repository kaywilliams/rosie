<?xml version="1.0" encoding="UTF-8"?>
<config-rpm id='httpd-config'>
<description>
Configures httpd and related firewall settings
</description>

<requires>httpd</requires>
<requires>firewalld</requires>
<requires>/usr/bin/ps</requires>

<script type='post'>
# configure httpd to start at system boot
systemctl -q enable httpd

# configure persistent firewall rules
file=/etc/firewalld/zones/public.xml
[ -f $file ] || cp /usr/lib/firewalld/zones/public.xml $file
sed -i "/&lt;\/zone>/d" $file
grep -qw http $file || echo '  &lt;service name="http"/>' >> $file
grep -qw https $file || echo '  &lt;service name="https"/>' >> $file
echo "&lt;/zone>" >> $file

# start http and reload firewall rules
if ! ps aux | grep "[/]sbin/anaconda"; then
  systemctl start httpd
  firewall-cmd -q --reload
fi
</script>
</config-rpm>
