<?xml version="1.0" encoding="UTF-8"?>
<config-rpm id='mysql-server-config' xmlns:xi="http://www.w3.org/2001/XInclude">
<requires>mysql</requires>
<requires>mysql-server</requires>
<requires>systemd-units</requires>

<macro id='mysql-password' type='script'>
#!/usr/bin/python
import uuid
print uuid.uuid4().hex[:16]
</macro>

<script type='post'>
/bin/systemctl enable mysqld 
/bin/systemctl reload-or-restart mysqld

# set password - the logic below is to attempt to access the database
# *without* a password. If we can, then we know we need to reset the password
# and we do so. Otherwise, we assume the password has been correctly set
# previously and we do nothing.
if mysql -u root -e "SHOW DATABASES;" &amp;>/dev/null; then
  mysql \
    -u root \
    -e "UPDATE mysql.user SET Password=PASSWORD('%{mysql-password}') WHERE User='root'; FLUSH PRIVILEGES;"
fi
</script>
</config-rpm>
