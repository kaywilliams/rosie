<?xml version="1.0" encoding="utf-8"?>
<xml xmlns:xi='http://www.w3.org/2001/XInclude'>
# %post
# set hostname - put this in a separate f19 scriptlet?
# this is necesssary in fedora 19 because it doesn't preserve ks provided
# hostname after reboot - see https://bugzilla.redhat.com/show_bug.cgi?id=977635
# only relevant to cdrom based kickstarts (i.e. iso install)
# doesn't help with setting dnsmasq hostname
# echo "%{hostname}" > /etc/hostname 
# %end

%post
# allow build machine to access client via ssh
# set some convenience variables
sshdir=/root/.ssh
authkeys=$sshdir/authorized_keys
pubkey="%{build-host-pubkey}"

# make sshdir if it doesn't exist
[[ -d $sshdir ]] || mkdir $sshdir 

# create authorized_keys file if it doesn't exist
[[ -f $authkeys ]] || touch $authkeys

# copy pubkey into authorized keys if it's not there already
[[ `cat $authkeys` == $pubkey ]] || echo $pubkey >> $authkeys
  
# set permissions
chmod 700 $sshdir
chmod 600 $authkeys
[[ -f /sbin/restorecon ]] &amp;&amp; /sbin/restorecon -r $sshdir
%end
</xml>

