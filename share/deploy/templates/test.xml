<?xml version="1.0" encoding="utf-8"?>
<definition xmlns:xi="http://www.w3.org/2001/XInclude">

<!--
See "Testing Package Repositories" in the Deploy user manual for
information on using this template.

This template requires the following macros to be defined either by including
definitions or on the Deploy command line:

repo - name of the package repository to test
scenario - name of the scenario to test
os - os to test, e.g. 'centos' or 'rhel'
version - default os version, e.g. '5' or '6'
arch - default os arch, e.g. 'i386' or 'x86_64'
password - root password for test machines
baseurl - full url to package repository on build machine, must be accessible from both build and test machines, e.g. "http://192.168.123.1/repos/package/%{repo}-%{os}-%{version}-%{arch}/"
-->

<main>
  <name>%{repo}-%{scenario}</name>
  <os>%{os}</os>
  <version>%{version}</version>
  <arch>%{arch}</arch>
  <id>%{id}</id>
</main>

<packages>
<group repoid='base'>core</group>
</packages>

<repos>
<repo id='%{repo}'>
<baseurl>%{baseurl}</baseurl>
</repo>
</repos>

<config-rpms>
<config-rpm id='test-config'>
<requires>%{repo}-release</requires>
<trigger type="triggerin" trigger='%{repo}-release'>
# tweak yum configuration so that it gets repo from test server 
# do this in a trigger so that it runs each time %{repo}-release rpm
# is updated
sed -i "s|^baseurl.*|baseurl = %{baseurl}|" /etc/yum.repos.d/%{repo}.repo
</trigger>
</config-rpm>
</config-rpms>

<test-install>
  <password>%{password}</password>
  <xi:include href="virt-deploy.xml"
              xpointer="xpointer(/*/*[name()!='script'])"/>
  <xi:include href="virt-deploy.xml"
              xpointer="xpointer(/*/script[@id!='check-kernel'])"/>
  <xi:include href="deploy/poweroff.xml"/>
</test-install>

<test-update>
  <xi:include xpointer="xpointer(/*/test-install/*)"/>
</test-update>

</definition>
